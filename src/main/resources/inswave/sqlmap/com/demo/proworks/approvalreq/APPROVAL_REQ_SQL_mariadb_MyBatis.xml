<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper      
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"      
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	@subject     : 결재요청 관련 처리를 담당하는 Sql Mapper
	@description : 결재요청 관련 처리를 담당하는 Sql Mapper
	@author      : Inswave
	@since       : 2025/07/14
	@modification
	===========================================================
	DATE              AUTHOR             DESC
	===========================================================
	2025/07/14              Inswave             최초 생성
 -->
<mapper namespace="com.demo.proworks.approvalreq">
    <insert id="insertApprovalReq" parameterType="com.demo.proworks.approvalreq.vo.ApprovalReqVo">
    	<!-- 결재요청를 등록한다. -->	
    		
        INSERT INTO APPROVAL_REQ   /* QueryID : com.demo.proworks.approvalreq.insertApprovalReq */
        ( 
            <if test="claim_no     != null">   CLAIM_NO      </if>
            <if test="emp_no       != null"> , EMP_NO        </if>
            <if test="manager_no   != null"> , MANAGER_NO    </if>
            <if test="approval_memo!= null"> , APPROVAL_MEMO </if>
        )
        VALUES  
        ( 
            <if test="claim_no     != null">  #{claim_no}      </if>
            <if test="emp_no       != null"> , #{emp_no}        </if>
            <if test="manager_no   != null"> , #{manager_no}    </if>
            <if test="approval_memo!= null"> , #{approval_memo} </if> 
        )          
    </insert>	
	
    <update id="updateApprovalReq" parameterType="com.demo.proworks.approvalreq.vo.ApprovalReqVo">
    	<!-- 결재요청를 갱신한다. -->
    	
        UPDATE APPROVAL_REQ    /* QueryID : com.demo.proworks.approvalreq.updateApprovalReq */      
      	  SET  
                APPROVAL_ID   = #{approval_id}          	                       
            <if test="claim_no     != null"> , CLAIM_NO      = #{claim_no}      </if>
            <if test="emp_no       != null"> , EMP_NO        = #{emp_no}        </if>
            <if test="manager_no   != null"> , MANAGER_NO    = #{manager_no}    </if>
            <if test="status       != null"> , STATUS        = #{status}        </if>
            <if test="approval_memo!= null"> , APPROVAL_MEMO = #{approval_memo} </if>                 
        WHERE   
                APPROVAL_ID   = #{approval_id}  
    </update>
	
    <delete id="deleteApprovalReq" parameterType="com.demo.proworks.approvalreq.vo.ApprovalReqVo">
    	<!-- 결재요청를 삭제한다. -->
    	
        DELETE FROM APPROVAL_REQ   /* QueryID : com.demo.proworks.approvalreq.deleteApprovalReq */ 
        WHERE   
                APPROVAL_ID   = #{approval_id}          
    </delete>
	
    <select id="selectApprovalReq" parameterType="com.demo.proworks.approvalreq.vo.ApprovalReqVo" resultType="com.demo.proworks.approvalreq.vo.ApprovalReqVo">
    	<!-- 결재요청를 상세 조회한다. -->	
        SELECT     /* QueryID : com.demo.proworks.approvalreq.selectApprovalReq */
            APPROVAL_ID, CLAIM_NO, EMP_NO, MANAGER_NO, APPROVAL_MEMO
        FROM APPROVAL_REQ 
        WHERE 
                APPROVAL_ID   = #{approval_id}  			
    </select>
	
    <select id="selectListApprovalReq" parameterType="com.demo.proworks.approvalreq.vo.ApprovalReqVo" resultType="com.demo.proworks.approvalreq.vo.ApprovalReqVo">
    	<!-- 결재요청 목록을 조회한다. -->
           SELECT    /* QueryID : com.demo.proworks.approvalreq.selectListApprovalReq */
               APPROVAL_ID, CLAIM_NO, EMP_NO, MANAGER_NO, APPROVAL_MEMO		       
           FROM (
               SELECT  S.*, CEIL( (@ROWNUM:=@ROWNUM+1) / #{pageSize} ) AS PAGE
               FROM (				
                   SELECT 
                       *  		                  
                   FROM APPROVAL_REQ
                   WHERE  1=1    		
                        <if test="SC_claim_no != null and SC_claim_no != ''">
                             AND CLAIM_NO like '%${SC_claim_no}%'
                        </if>
                        <if test="SC_emp_no != null and SC_emp_no != ''">
                             AND EMP_NO like '%${SC_emp_no}%'
                        </if>
                        <if test="SC_manager_no != null and SC_manager_no != ''">
                             AND MANAGER_NO like '%${SC_manager_no}%'
                        </if>	     																														
               ) S, (SELECT @ROWNUM := 0) TMP
           ) A
            WHERE PAGE = #{pageIndex}
    </select>
	
    <select id="selectListCountApprovalReq" parameterType="com.demo.proworks.approvalreq.vo.ApprovalReqVo" resultType="long">
    <!-- 결재요청 목록의 카운트를 조회한다. -->
    
         SELECT    /* QueryID : com.demo.proworks.approvalreq.selectListCountApprovalReq */
             COUNT(*) totcnt  		                  
         FROM APPROVAL_REQ
         WHERE  1=1    		
            <if test="SC_claim_no != null and SC_claim_no != ''">
                 AND CLAIM_NO like '%${SC_claim_no}%'
            </if>
            <if test="SC_emp_no != null and SC_emp_no != ''">
                 AND EMP_NO like '%${SC_emp_no}%'
            </if>
            <if test="SC_manager_no != null and SC_manager_no != ''">
                 AND MANAGER_NO like '%${SC_manager_no}%'
            </if>
    </select>

</mapper>
