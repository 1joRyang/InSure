<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.demo.proworks.supplement">
	<select id="selectSupplementInfo" parameterType="com.demo.proworks.supplement.vo.SuppVo" resultType="com.demo.proworks.supplement.vo.SuppVo">
        SELECT
            c.claim_no AS claimNo,          -- 청구번호
            c.claim_type AS claimType,      -- 청구유형
            c.status AS status,             -- 현재 상태
            c.emp_no AS empNo,              -- 담당자 사원번호
            e.emp_name        AS empName,	-- 심사자 이름
            s.additional_memo AS additionalMemo -- 심사자 보완 요청 내용
        FROM
            CLAIM AS c
        LEFT JOIN
            ADDITIONAL_REQ AS s ON c.claim_no = s.claim_no
        LEFT JOIN
        	EMPLOYEE AS e ON c.emp_no = e.emp_no
        WHERE
            c.claim_no = #{claimNo}       -- 파라미터로 받은 청구번호
            AND c.ID = #{ID};             -- 파라미터로 받은 사용자 ID (ProworksCommVO에 ID 필드가 있다고 가정)
    </select>
    
    <update id="updateSupplementCompleted" parameterType="com.demo.proworks.supplement.vo.SuppVo">
	    /* QueryID: com.demo.proworks.supplement.updateSupplementCompleted */
	    UPDATE ADDITIONAL_REQ
	    SET
	        completed_date = NOW()
	    WHERE
	        claim_no = #{claimNo}
	</update>
	
	<update id="updateClaimStatus" parameterType="com.demo.proworks.supplement.vo.SuppVo">
        /* QueryID: com.demo.proworks.supplement.updateClaimStatus */
        UPDATE CLAIM
        SET
            status = #{status}
        WHERE
            claim_no = #{claimNo}
    </update>

</mapper>
