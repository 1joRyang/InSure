<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper      
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"      
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	@subject     : Ïã§Î¨¥Ïûê,Í¥ÄÎ¶¨ÏûêÏ†ïÎ≥¥ Í¥ÄÎ†® Ï≤òÎ¶¨Î•º Îã¥ÎãπÌïòÎäî Sql Mapper
	@description : Ïã§Î¨¥Ïûê,Í¥ÄÎ¶¨ÏûêÏ†ïÎ≥¥ Í¥ÄÎ†® Ï≤òÎ¶¨Î•º Îã¥ÎãπÌïòÎäî Sql Mapper
	@author      : ÏûÑÏÜåÌù¨
	@since       : 2025/06/30
	@modification
	===========================================================
	DATE              AUTHOR             DESC
	===========================================================
	2025/06/30              ÏûÑÏÜåÌù¨             ÏµúÏ¥à ÏÉùÏÑ±
 -->
<mapper namespace="com.demo.proworks.employee">
    <insert id="insertEmployee" parameterType="com.demo.proworks.employee.vo.EmployeeVo">
    	<!-- Ïã§Î¨¥Ïûê,Í¥ÄÎ¶¨ÏûêÏ†ïÎ≥¥Î•º Îì±Î°ùÌïúÎã§. -->	
    		
        INSERT INTO EMPLOYEE   /* QueryID : com.demo.proworks.employee.insertEmployee */
        ( 
            EMP_NO
            <if test="empName!= null"> , EMP_NAME </if>
            <if test="status  != null"> , STATUS   </if>
            <if test="deptId != null"> , DEPT_ID  </if>
            <if test="role    != null"> , ROLE     </if>
            <if test="empPw    != null"> , EMP_PW     </if>
        )
        VALUES  
        ( 
            #{empNo}
            <if test="empName!= null"> , #{empName} </if>
            <if test="status  != null"> , #{status}   </if>
            <if test="deptId != null"> , #{deptId}  </if>
            <if test="role    != null"> , #{role}     </if> 
            <if test="empPw    != null"> , #{empPw}      </if>
        )          
    </insert>	
	
    <update id="updateEmployee" parameterType="com.demo.proworks.employee.vo.EmployeeVo">
    	<!-- Ïã§Î¨¥Ïûê,Í¥ÄÎ¶¨ÏûêÏ†ïÎ≥¥Î•º Í∞±Ïã†ÌïúÎã§. -->
    	
        UPDATE EMPLOYEE    /* QueryID : com.demo.proworks.employee.updateEmployee */      
      	  SET  
                EMP_NO   = #{empNo}          	                       
            <if test="empName!= null"> , EMP_NAME = #{empName} </if>
            <if test="status  != null"> , STATUS   = #{status}   </if>
            <if test="deptId != null"> , DEPT_ID  = #{deptId}  </if>
            <if test="role    != null"> , ROLE     = #{role}     </if>
            <if test="empPw    != null"> , EMP_PW  = #{empPw}   </if>                 
        WHERE   
                EMP_NO   = #{empNo}  
    </update>
	
    <delete id="deleteEmployee" parameterType="com.demo.proworks.employee.vo.EmployeeVo">
    	<!-- Ïã§Î¨¥Ïûê,Í¥ÄÎ¶¨ÏûêÏ†ïÎ≥¥Î•º ÏÇ≠Ï†úÌïúÎã§. -->
    	
        DELETE FROM EMPLOYEE   /* QueryID : com.demo.proworks.employee.deleteEmployee */ 
        WHERE   
                EMP_NO   = #{empNo}          
    </delete>
	
    <select id="selectEmployee" parameterType="com.demo.proworks.employee.vo.EmployeeVo" resultType="com.demo.proworks.employee.vo.EmployeeVo">
    	<!-- Ïã§Î¨¥Ïûê,Í¥ÄÎ¶¨ÏûêÏ†ïÎ≥¥Î•º ÏÉÅÏÑ∏ Ï°∞ÌöåÌïúÎã§. -->	
        SELECT     /* QueryID : com.demo.proworks.employee.selectEmployee */
            EMP_NO as empNo, EMP_NAME as empName, STATUS as status, DEPT_ID as deptId, ROLE as role, EMP_PW as empPw
        FROM EMPLOYEE 
        WHERE 
                EMP_NO   = #{empNo}  			
    </select>
	
    <select id="selectListEmployee" parameterType="com.demo.proworks.employee.vo.EmployeeVo" resultType="com.demo.proworks.employee.vo.EmployeeVo">
    	<!-- Ïã§Î¨¥Ïûê,Í¥ÄÎ¶¨ÏûêÏ†ïÎ≥¥ Î™©Î°ùÏùÑ Ï°∞ÌöåÌïúÎã§. -->
           SELECT    /* QueryID : com.demo.proworks.employee.selectListEmployee */
               EMP_NO as empNo, EMP_NAME as empName, STATUS as status, DEPT_ID as deptId, ROLE as role, EMP_PW as empPw	       
           FROM (
               SELECT  S.*, CEIL( (@ROWNUM:=@ROWNUM+1) / #{pageSize} ) AS PAGE
               FROM (				
                   SELECT 
                       *  		                  
                   FROM EMPLOYEE
                   WHERE  1=1    		
	     																														
               ) S, (SELECT @ROWNUM := 0) TMP
           ) A
            WHERE PAGE = #{pageIndex}
    </select>
	
    <select id="selectListCountEmployee" parameterType="com.demo.proworks.employee.vo.EmployeeVo" resultType="long">
    <!-- Ïã§Î¨¥Ïûê,Í¥ÄÎ¶¨ÏûêÏ†ïÎ≥¥ Î™©Î°ùÏùò Ïπ¥Ïö¥Ìä∏Î•º Ï°∞ÌöåÌïúÎã§. -->
    
         SELECT    /* QueryID : com.demo.proworks.employee.selectListCountEmployee */
             COUNT(*) totcnt  		                  
         FROM EMPLOYEE
         WHERE  1=1    		

    </select>

	<select id="selectListEmployeeForRule" parameterType="com.demo.proworks.employee.vo.EmployeeVo" resultType="com.demo.proworks.employee.vo.EmployeeVo">
		SELECT
		EMP_NO as empNo,
		EMP_NAME as empName,
		STATUS as status,
		DEPT_ID as deptId,
		ROLE as role
		FROM EMPLOYEE
		WHERE 1=1
		<if test="deptId != null and deptId != ''">
			AND DEPT_ID = #{deptId}
		</if>
		<if test="status != null and status != ''">
			AND STATUS = #{status}
		</if>
		<if test="role != null and role != ''">
			AND ROLE = #{role}
		</if>
	</select>



	<!-- üî• Î∂ÄÏÑúIDÏôÄ ÏÉÅÌÉú Ï°∞Í±¥ÏúºÎ°ú ÏßÅÏõê Î™©Î°ù Ï°∞Ìöå (Î∞∞Ï†ï Ï†ÑÏö©) -->
	<select id="selectEmployeesByDeptAndStatus" parameterType="com.demo.proworks.employee.vo.EmployeeVo" 
		resultType="com.demo.proworks.employee.vo.EmployeeVo">
		SELECT /* QueryID : com.demo.proworks.employee.selectEmployeesByDeptAndStatus */
			EMP_NO as empNo, 
			EMP_NAME as empName, 
			STATUS as status, 
			DEPT_ID as deptId, 
			ROLE as role,
			EMP_PW AS empPw
		FROM EMPLOYEE
		WHERE 1=1
			<if test="deptId != null and deptId != ''">
			AND DEPT_ID = #{deptId}
			</if>
			<if test="status != null and status != ''">
			AND STATUS = #{status}
			</if>
		ORDER BY EMP_NO
	</select>

	<!-- üî• Î∂ÄÏÑúÎ≥Ñ ÎßàÏßÄÎßâ Î∞∞Ï†ïÎêú ÏßÅÏõê Ï°∞Ìöå (ÎùºÏö¥ÎìúÎ°úÎπàÏö©) -->
	<select id="selectLastAssignedEmployeeInDept" parameterType="string" resultType="java.lang.Integer">
		SELECT /* QueryID : com.demo.proworks.employee.selectLastAssignedEmployeeInDept */
			CAST(MAX(c.EMP_NO) AS SIGNED) as lastEmpNo
		FROM CLAIM c
		JOIN EMPLOYEE e ON c.EMP_NO = e.EMP_NO
		WHERE e.DEPT_ID = #{deptId}
		  AND e.STATUS = 'Ïû¨ÏßÅÏ§ë'
		  AND c.EMP_NO IS NOT NULL
	</select>

	<!-- üî• Îã§Ïùå Î∞∞Ï†ïÌï† ÏßÅÏõê Ï°∞Ìöå (ÎùºÏö¥ÎìúÎ°úÎπà Î∞©Ïãù) -->
	<select id="selectNextEmployeeForAssignment" parameterType="com.demo.proworks.employee.vo.EmployeeVo" 
		resultType="com.demo.proworks.employee.vo.EmployeeVo">
		SELECT /* QueryID : com.demo.proworks.employee.selectNextEmployeeForAssignment */
			EMP_NO as empNo, 
			EMP_NAME as empName, 
			STATUS as status, 
			DEPT_ID as deptId, 
			ROLE as role,
			EMP_PW AS empPw
		FROM EMPLOYEE
		WHERE DEPT_ID = #{deptId}
		  AND STATUS = 'Ïû¨ÏßÅÏ§ë'
		  <if test="lastEmpNo != null">
		  AND EMP_NO > #{lastEmpNo}
		  </if>
		ORDER BY EMP_NO
		LIMIT 1
	</select>

	<!-- üî• Î∂ÄÏÑúÏùò Ï≤´ Î≤àÏß∏ ÏßÅÏõê Ï°∞Ìöå (ÎùºÏö¥ÎìúÎ°úÎπà ÏàúÌôòÏö©) -->
	<select id="selectFirstEmployeeInDept" parameterType="string" 
		resultType="com.demo.proworks.employee.vo.EmployeeVo">
		SELECT /* QueryID : com.demo.proworks.employee.selectFirstEmployeeInDept */
			EMP_NO as empNo, 
			EMP_NAME as empName, 
			STATUS as status, 
			DEPT_ID as deptId, 
			ROLE as role,
			EMP_PW AS empPw
		FROM EMPLOYEE
		WHERE DEPT_ID = #{deptId}
		  AND STATUS = 'Ïû¨ÏßÅÏ§ë'
		ORDER BY EMP_NO
		LIMIT 1
	</select>

</mapper>