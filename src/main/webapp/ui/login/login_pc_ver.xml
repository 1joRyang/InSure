<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
        
    <head>
                
        <w2:type>COMPONENT</w2:type>
                
        <w2:buildDate/>
                
        <w2:MSA/>
                
        <xf:model>

        	<w2:dataCollection baseNode="map">
        		<w2:dataMap baseNode="map" id="dma_login_request">
        			<w2:keyInfo>
        				<w2:key dataType="text" name="실무자아이디" id="empNo"></w2:key>
        				<w2:key dataType="text" name="비밀번호" id="empPw"></w2:key>
        				<w2:key dataType="text" name="로그인 타입" id="loginType"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        		<w2:dataMap baseNode="map" id="dma_login_response">
        			<w2:keyInfo>
        				<w2:key dataType="text" name="실무자아이디" id="empNo"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        	</w2:dataCollection>

        	<w2:workflowCollection />

        	<xf:submission id="sbm_EmployeeLogin" action="/InsWebApp/EmployeeLogin.pwkjson" method="post" mediatype="application/json" ref='data:json,[{"id":"dma_login_request","key":"elData"},{"id":"dma_login_response","key":"elData"}]' target=""
        		encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit=""
        		ev:submitdone="scwin.sbm_EmployeeLogin_submitdone" ev:submiterror="" abortTrigger="">
        	</xf:submission>
        </xf:model>

        <w2:layoutInfo/>
                
        <w2:publicInfo method=""/>
                
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function() {
	// 1. dma_login_request 데이터맵을 초기화합니다.
    dma_login_request.set("empNo", "");
    dma_login_request.set("empPw", "");

    // 2. 이 페이지는 직원 로그인 전용이므로, loginType을 'EMPLOYEE'로 미리 설정합니다.
    dma_login_request.set("loginType", "EMPLOYEE");

    // 3. 페이지 로드 시 아이디 입력창에 포커스를 줍니다.
    ibx_empNo.focus();
};

/**
 * 로그인 버튼(trigger)을 클릭했을 때 실행되는 함수입니다.
 * 입력값 유효성을 검사하고, 서버에 로그인을 요청합니다.
 */
scwin.trigger1_login_onclick = function(e) {
    // 1. 아이디 입력값 검증
    if (dma_login_request.get("empNo") === "") {
        alert("아이디를 입력해주세요.");
        ibx_empNo.focus();
        return;
    }

    // 2. 비밀번호 입력값 검증
    if (dma_login_request.get("empPw") === "") {
        alert("비밀번호를 입력해주세요.");
        ibx_empPw.focus(); 
        return;
    }

    // 3. 디버깅을 위한 로그 출력
    console.log("전송할 데이터:", dma_login_request.getJSON());
    

    // . 유효성 검사를 통과하면 sbm_EmployeeLogin 서브미션을 실행하여 서버에 데이터를 전송합니다.
     var reqData = dma_login_request.getJSON();
    $c.sbm.execute(sbm_EmployeeLogin, reqData);
};

scwin.sbm_EmployeeLogin_submitdone = function (e) {
    
    try {
        console.log("서버 응답:", e); // 디버깅용

        //성공 여부를 응답받은 JSON 데이터의 존재 유무로 직접 확인합니다.
        // 서버가 dma_login_response 데이터를 정상적으로 보냈다면 성공으로 간주합니다.
        if (e && e.responseJSON && e.responseJSON.dma_login_response) {


            // 메인 페이지로 이동합니다.
            location.href = "/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/main/mainWrapper.xml";
            
        } else {
            // 로그인 실패 시 처리
            // (서버에서 dma_login_response를 보내지 않았거나, 통신 오류 발생)
            // 실패 메시지는 프레임워크가 자동으로 띄워주므로, 여기서는 UI만 처리합니다.
            dma_login_request.set("empPw", "");
            ibx_empPw.focus();
        }
    } catch (error) {
        console.error("로그인 결과 처리 중 오류가 발생했습니다:", error);
        alert("로그인 결과를 처리하는 중 오류가 발생했습니다.");
    }
};


// 에러 처리 함수도 추가
scwin.sbm_EmployeeLogin_submiterror = function(e) {
    console.error("서브미션 에러:", e);
    alert("서버와의 통신 중 오류가 발생했습니다.");
    dma_login_request.set("pw", "");
    ibx_empPw.focus();
};
]]></script>
            
    </head>
        
    <body class="" ev:onpageload="scwin.onpageload">

    	<xf:group class="login_wrap" id="" style=";background-image:/InsWebApp/images/ws5/logo/insureLogo.png;">

    		<xf:group class="login_logo" id="" tagname="h1">


    			<xf:image id="" src="/InsWebApp/images/ws5/logo/insureLogo.png" style="width:142px;height:47px;"></xf:image>
    		</xf:group>

    		<xf:group class="login_container" id="" style="left:560px; ">

    			<xf:group class="login_header" id="">

    				<xf:group style="width:360px;height:65px;background-position:center;vertical-align:middle;text-align:center;" id="">
    					<xf:image src="/InsWebApp/images/ws5/logo/insureLogo.png" style="width:142px;height:47px;" id=""></xf:image>
    				</xf:group>
    			</xf:group>
    			<xf:group class="login_contents" id="" style="">

    				<xf:group id="" tagname="ul">

    					<xf:group id="" tagname="li">

    						<w2:textbox class="tit" for="user_id" id="" label="아이디" style="" tagname="label" />

    						<xf:input adjustMaxLength="false" id="ibx_empNo" placeholder="아이디를 입력해주세요." style="" ref="data:dma_login_request.empNo"/>

    					</xf:group>

    					<xf:group id="" tagname="li">

    						<w2:textbox class="tit" for="user_pw" id="" label="비밀번호" style="" tagname="label" />

    						<xf:group class="login_form" id="">

    							<xf:input adjustMaxLength="false" id="ibx_empPw" placeholder="비밀번호를 입력해주세요." style="" type="password" ref="data:dma_login_request.empPw"/>

    							<w2:anchor class="btn_login_password" id="" outerDiv="false" style="">

    								<xf:label><![CDATA[비밀번호 보기]]></xf:label>

    							</w2:anchor>

    						</xf:group>

    						<xf:group class="grp_password" id="">
    							<xf:select appearance="full" cols="" id="" ref="" rows="" selectedindex="-1" style="">

    								<xf:choices>

    									<xf:item>

    										<xf:label><![CDATA[Remember me]]></xf:label>

    										<xf:value />

    									</xf:item>

    								</xf:choices>

    							</xf:select>
    							<w2:anchor class="link_password" id="" outerDiv="false" style="">

    								<xf:label><![CDATA[Forgot password?]]></xf:label>

    							</w2:anchor>
    						</xf:group>
    					</xf:group>

    				</xf:group>

    				<xf:group class="login_btn" id="" style="">

    					<xf:trigger class="btn_login" id="trigger1_login" style="" type="button" ev:onclick="scwin.trigger1_login_onclick">

    						<xf:label><![CDATA[Login]]></xf:label>

    					</xf:trigger>

    				</xf:group>

    				<xf:group class="login_account" id="" style="">

    					<w2:textbox class="" id="" label="New user?" style="" />
    					<w2:anchor class="link_account" id="" outerDiv="false" style="">

    						<xf:label><![CDATA[Create an account]]></xf:label>

    					</w2:anchor>


    				</xf:group>

    			</xf:group>


    		</xf:group>

    		<xf:group style="width:454px;height:378px;" id=""></xf:group>
    	</xf:group>

    	
    </body>

</html>
