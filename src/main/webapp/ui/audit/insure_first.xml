<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
            <w2:dataCollection baseNode="map">
            	<w2:dataMap baseNode="map" id="dm_header">
            		<w2:keyInfo>
            			<w2:key dataType="text" name="청구번호" id="claimNo"></w2:key>
            			<w2:key dataType="text" name="피보험자" id="patient"></w2:key>
            		</w2:keyInfo>
            	</w2:dataMap>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function () {
    scwin.emp = JSON.parse(localStorage.getItem("employee"));

    scwin.claim = JSON.parse(localStorage.getItem("claim"));
    dm_header.set("patient", scwin.claim.userName);
    dm_header.set("claimNo", scwin.claim.claimNo);

    // 담당자 아니면 readonly
    if (scwin.emp.empNo != scwin.claim.empNo || (
        scwin.claim.status != "결재완료" &&
        scwin.claim.status != "결재반려" &&
        scwin.claim.status != "대기" &&
        scwin.claim.status != "보완완료" )) {
        btn_reject.hide();
        btn_change.hide();
        btn_sup.hide();
    }
};

scwin.btn_next_onclick = function (e) {
    // 페이지 이동
    location.href = "/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/audit/insure_second.xml";
};

scwin.btn_change_onclick = function (e) {
    // 담당자 변경 팝업 호출
    openChangeAssigneePopup("/InsWebApp/ui/Assignment/change-assignee-popup.xml");
};

// 담당자 변경 팝업 함수
function openChangeAssigneePopup(link) {
    requires("uiplugin.popup");
    var winWid = $(window).width();
    var winHei = $(window).height();
    var popWid = 600;  // 담당자 변경 팝업에 적합한 크기
    var popHei = 350;
    var sumLeft = (winWid - popWid) / 2;
    var sumTop = (winHei - popHei) / 2;

    var opts = {
        "id": "change_assignee_popup",
        "type": "litewindow",
        "width": popWid + "px",
        "height": popHei + "px",
        "top": sumTop,
        "left": sumLeft,
        "popupName": "담당자 변경",
        "modal": true,
        "useIFrame": false,
        "title": "담당자 변경",
        "useATagBtn": false,
        "frameMode": "wframe",
    };

    $p.openPopup(link, opts);
}

scwin.btn_reject_onclick = function (e) {
    openClaimReturnPopup("/InsWebApp/ui/Assignment/claimReturnPopup.xml");
};

function openClaimReturnPopup(link) {
    requires("uiplugin.popup");
    var winWid = $(window).width();
    var winHei = $(window).height();
    var popWid = 500;  // 담당자 변경 팝업에 적합한 크기
    var popHei = 400;
    var sumLeft = (winWid - popWid) / 2;
    var sumTop = (winHei - popHei) / 2;

    var opts = {
        "id": "claim_return_popup",
        "type": "litewindow",
        "width": popWid + "px",
        "height": popHei + "px",
        "top": sumTop,
        "left": sumLeft,
        "popupName": "반송 요청",
        "modal": true,
        "useIFrame": false,
        "title": "반송 요청",
        "useATagBtn": false,
        "frameMode": "wframe",
    };

    $p.openPopup(link, opts);
}

scwin.btn_sup_onclick = function (e) {
     openClaimSupplyPopup("/InsWebApp/ui/Assignment/reqSupplePopup.xml");

};

function openClaimSupplyPopup(link) {
    requires("uiplugin.popup");
    var winWid = $(window).width();
    var winHei = $(window).height();
    var popWid = 500;  
    var popHei = 400;
    var sumLeft = (winWid - popWid) / 2;
    var sumTop = (winHei - popHei) / 2;

    var opts = {
        "id": "claim_supply_popup",
        "type": "litewindow",
        "width": popWid + "px",
        "height": popHei + "px",
        "top": sumTop,
        "left": sumLeft,
        "popupName": "보완 요청",
        "modal": true,
        "useIFrame": false,
        "title": "보완 요청",
        "useATagBtn": false,
        "frameMode": "wframe",
    };

    $p.openPopup(link, opts);
}]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
    	<w2:wframe style="z-index: 20;top: 0;width: 100%;" id="" src="/InsWebApp/ui/cmmn/header.xml"></w2:wframe>
    	<xf:group meta_snippetCategory="00_화면시작" meta_snippetName="0_01 페이지시작" meta_snippetKeyComponent="true" style="" id=""
    		class="sub_contents">
    		<xf:group style="justify-content: space-between;" class="pgtbox">
    			<xf:group style="display: flex;" id="">
    				<w2:textbox style="float: right;;" label="피보험자: " class="pgt_tit"></w2:textbox>
    				<w2:textbox ref="data:dm_header.patient" style="padding-left: 10px;" id="" label="" class="pgt_tit"></w2:textbox>
    			</xf:group>
    			<xf:group style="display: flex;" id="">
    				<w2:textbox ref="" label="청구번호: " class="pgt_tit"></w2:textbox>
    				<w2:textbox ref="data:dm_header.claimNo" style="padding-left: 10px;" id="" label="" class="pgt_tit"></w2:textbox>
    			</xf:group>
    		</xf:group>
            <w2:wframe src="/InsWebApp/ui/audit/img_modal.xml" style="width: 100%;height: 700px;" id=""></w2:wframe>
    		<xf:group meta_snippetCategory="08_버튼" meta_snippetName="8_04 전체제어버튼" meta_snippetKeyComponent="true" style="margin-top: 40px;"
    			id="" class="btnbox">
    			<xf:group style="" id="" class="rt">
    				<xf:trigger class="btn_cm" id="btn_sup" meta_snippetCategory="08_버튼" meta_snippetKeyComponent="true"
    					meta_snippetName="8_01 기본버튼" style="" type="button" ev:onclick="scwin.btn_sup_onclick">
    					<xf:label><![CDATA[보완]]></xf:label>
    				</xf:trigger>
    				<xf:trigger style="" id="btn_reject" type="button" class="btn_cm" ev:onclick="scwin.btn_reject_onclick">
    					<xf:label><![CDATA[반송]]></xf:label>
    				</xf:trigger>
    				<xf:trigger ev:onclick="scwin.btn_change_onclick" style="" id="btn_change" type="button" class="btn_cm ">
    					<xf:label><![CDATA[처리자변경]]></xf:label>
    				</xf:trigger>
    				<xf:trigger ev:onclick="scwin.btn_next_onclick" style="" id="btn_next" type="button" class="btn_cm pt">
    					<xf:label><![CDATA[다음]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    		</xf:group>
    	</xf:group>
    </body>
</html>
