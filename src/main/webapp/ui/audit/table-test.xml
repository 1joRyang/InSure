<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/InsWebApp/css/table.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
            <w2:dataCollection baseNode="map">
            	<w2:dataMap baseNode="map" id="dm_sub">
            		<w2:keyInfo>
            			<w2:key dataType="text" name="진료비총액" id="total_medical_fee"></w2:key>
            			<w2:key dataType="text" name="환자부담총액" id="total_patient_payment"></w2:key>
            			<w2:key dataType="text" name="이미납부한금액" id="amount_paid"></w2:key>
            			<w2:key dataType="text" name="납부할금액" id="due_amt"></w2:key>
            			<w2:key dataType="text" name="납부한금액" id="due_pay"></w2:key>
            		</w2:keyInfo>
            	</w2:dataMap>
            	<w2:dataMap baseNode="map" id="dm_result">
            		<w2:keyInfo>
            			<w2:key dataType="text" name="최종수납액" id="final_due"></w2:key>
            			<w2:key dataType="text" name="병원공제금" id="hospital_prepaid"></w2:key>
            			<w2:key dataType="text" name="삭감항목금액" id="deducation_amt"></w2:key>
            			<w2:key dataType="text" name="산출금" id="refund_amt"></w2:key>
            		</w2:keyInfo>
            	</w2:dataMap>
            	<w2:dataList baseNode="list" repeatNode="map" id="dl_result" saveRemovedData="true">
            		<w2:columnInfo>
            			<w2:column dataType="text" name="구분" id="col1"></w2:column>
            			<w2:column dataType="text" name="금액산정내용" id="col2"></w2:column>
            		</w2:columnInfo>
            		<w2:data use="true">
            			<w2:row>
            				<col1><![CDATA[최종수납]]></col1>
            				<col2><![CDATA[0]]></col2>
            			</w2:row>
            			<w2:row>
            				<col1><![CDATA[병원공제금]]></col1>
            				<col2><![CDATA[0]]></col2>
            			</w2:row>
            			<w2:row>
            				<col1><![CDATA[삭감항목총액]]></col1>
            				<col2><![CDATA[0]]></col2>
            			</w2:row>
            			<w2:row>
            				<col1><![CDATA[산출금]]></col1>
            				<col2><![CDATA[0]]></col2>
            			</w2:row>
            		</w2:data>
            	</w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script cache="false" scopeExternal="false" src="/InsWebApp/js/insure/ocr-table.js" scopeVariable="" type="text/javascript"></script>
        <script cache="false" scopeExternal="false" src="/InsWebApp/js/insure/ocr-tableStruc.js" scopeVariable="" type="text/javascript"></script>
        <script lazy="false" type="text/javascript"><![CDATA[// 페이지 로드 시 모든 테이블 생성
scwin.onpageload = function() {
    // todo: 테이블 불러와서 넣기
    // 페이지가 로드될 때 기본 빈 테이블 생성
    scwin.createEmptyTable();
    
    let savedData = JSON.parse(localStorage.getItem('dateList') || '[]');

    savedData.forEach(item => {
        date_drop.addItem(item.imgIdx, item.dateRange);
    });
    date_drop.setSelectedIndex(0);
};

scwin.btn_ocr_onclick = function (e) {
    // OCR 버튼 클릭 시 OCR 결과를 받아서 테이블을 동적으로 업데이트
    let data_rows = [
        { "col1": "진찰료", "col2": 100, "col3": 200, "col4": 300, "col5": 400, "col6": 500 },
        { "col1": "1인실", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "식대", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "행위료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "약품비", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "행위료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "약품비", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "마취료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "처치및수술료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "검사료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "영상진단료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "방사선치료료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "치료재료대", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "재활및물리치료료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "정신요법료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "전혈및혈액성분제제료", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "보장구", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
        { "col1": "CD필름", "col2": 0, "col3": 0, "col4": 0, "col5": 0, "col6": 0 },
    ];
    
    // 수정된 헤더 - 실제 받아오는 데이터 헤더
    let headers = ["본인부담금", "공단부담금", "전액본인부담", "선택진료료", "선택진료료 외"];
    
    let result = {
        'success': true,
        'message': 'OCR 처리가 완료되었습니다.',
        'data': {
            'headers': headers,
            'rows': data_rows,
            'total_rows': data_rows.length,
            'total_columns': headers.length
        }
    };
    
    scwin.createTable(result);
};

scwin.btn_before_onclick = function (e) {
    // 이전 화면으로
    
};

scwin.btn_next_onclick = function (e) {
    // 다음 화면으로
};

scwin.ipt_paid_onchange = function (info) {
    setTotalPay();
};

scwin.ipt_pay_onchange = function (info) {
    setTotalPay();
};

function setTotalPay() {
    let total = Number(ipt_pay.getValue()) + Number(ipt_paid.getValue());
    ipt_fianlpay.setValue(total);

    calcuResultTableTotal();
}

scwin.sel_hospital_onchange = function (info) {
    ipt_hosp.setValue(0);
    let hospital_prepaid = info.newValue === "1" ? 10000 : info.newValue === "2" ? 15000 : 20000;
    ipt_hosp.setValue(hospital_prepaid);

    calcuResultTableTotal();
};

// result table 산출금 계산 
function calcuResultTableTotal() {
    let value = Number(ipt_fianlpay.getValue()) - Number(ipt_excTotal.getValue()) - Number(ipt_hosp.getValue());
    console.log(value);
    ipt_result.setValue(value);
}

scwin.ipt_excTotal_onchange = function (info) {
    calcuResultTableTotal();
};
]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
        <xf:group class="sub_contents">
        	<xf:group class="pgtbox">
        		<w2:textbox class="pgt_tit" label="청구번호: " />
        		<w2:textbox class="pgt_tit" label="피보험자: " />
        		<xf:group class="btn_schbox">
        		</xf:group>
        		<xf:group class="schbox" id="" meta_snippetCategory="03_조회영역" meta_snippetKeyComponent="true" meta_snippetName="3_02 조회조건2행"
        			style="">
        			<xf:group class="schbox_inner" id="" style="">
        				<xf:group adaptive="layout" adaptiveThreshold="768" class="w2tb tbl " id="" style="" tagname="table">
        					<w2:attributes>
        						<w2:summary></w2:summary>
        					</w2:attributes>
        					<xf:group tagname="colgroup">
        						<xf:group style="width:100px;" tagname="col"></xf:group>
        						<xf:group style="" tagname="col"></xf:group>
        						<xf:group style="width:100px;" tagname="col"></xf:group>
        						<xf:group style="" tagname="col"></xf:group>
        					</xf:group>
        					<xf:group class="" id="" style="" tagname="tr">
        						<xf:group class="w2tb_th" style="" tagname="th">
        							<w2:textbox class="" id="" label="입통원일자" style=""></w2:textbox>
        						</xf:group>
        						<xf:group class="w2tb_td" style="" tagname="td">
        							<xf:select1 allOption="" appearance="minimal" chooseOption="" class="" direction="auto" disabled="false"
        								disabledClass="w2selectbox_disabled" id="date_drop" ref="" renderType="" style="width:150px;" submenuSize="auto">
        								<xf:choices></xf:choices>
        							</xf:select1>
        						</xf:group>
        						<xf:group class="w2tb_th" style="" tagname="th">
        							<w2:textbox class="req" id="" label="진료과/병원명" style=""></w2:textbox>
        						</xf:group>
        						<xf:group class="w2tb_td" id="" style="" tagname="td">
        							<xf:input id="" style="width:150px;"></xf:input>
        							<xf:input id="" style="width:150px;"></xf:input>
        						</xf:group>
        					</xf:group>
        					<xf:group class="" id="" style="" tagname="tr">
        						<xf:group class="w2tb_th" style="" tagname="th">
        							<w2:textbox class="" id="" label="병원등급" style=""></w2:textbox>
        						</xf:group>
        						<xf:group class="w2tb_td" style="" tagname="td">
        							<xf:select1 id="sel_hospital" chooseOption="" style="width:150px;" submenuSize="auto"
        								allOption="" disabled="false" direction="auto" appearance="minimal" disabledClass="w2selectbox_disabled" ref="" ev:onchange="scwin.sel_hospital_onchange">
        								<xf:choices>
        									<xf:item>
        										<xf:label><![CDATA[1차]]></xf:label>
        										<xf:value><![CDATA[1]]></xf:value>
        									</xf:item>
        									<xf:item>
        										<xf:label><![CDATA[2차]]></xf:label>
        										<xf:value><![CDATA[2]]></xf:value>
        									</xf:item>
        									<xf:item>
        										<xf:label><![CDATA[3차]]></xf:label>
        										<xf:value><![CDATA[3]]></xf:value>
        									</xf:item>
        								</xf:choices>
        							</xf:select1>
        						</xf:group>
        						<xf:group class="w2tb_th" style="" tagname="th">
        							<w2:textbox class="" id="" label="환자구분" style=""></w2:textbox>
        						</xf:group>
        						<xf:group class="w2tb_td" id="" style="" tagname="td">
        							<xf:input id="" style="width:150px;"></xf:input>
        						</xf:group>
        					</xf:group>
        				</xf:group>
        			</xf:group>
        			<xf:group class="btn_schbox" id="" style="">
        				<xf:trigger class="btn_cm sch" disabled="" escape="false" id="btn_ocr" style="" type="button" ev:onclick="scwin.btn_ocr_onclick">
        					<xf:label><![CDATA[조회]]></xf:label>
        				</xf:trigger>
        			</xf:group>
        		</xf:group>
        	</xf:group>
        	<!-- 동적으로 테이블을 생성할 공간 -->
        	<xf:group style="width: 100%; display: flex;" id="">
        		<xf:group style="width: 70%;" id="">
        			<div style="" id="tableContainer"></div>
        		</xf:group>
        		<xf:group style="width: 30%; margin-left: 15px;" id="">
        			<xf:group tagname="table" style="width:100%;height: 100px;" id="" class="w2tb">
        				<w2:attributes>
        					<w2:summary></w2:summary>
        				</w2:attributes>
        				<xf:group tagname="caption"></xf:group>
        				<xf:group tagname="colgroup">
        					<xf:group tagname="col" style="width:50.00%;"></xf:group>
        					<xf:group tagname="col" style="width:50.00%;"></xf:group>
        				</xf:group>
        				<xf:group tagname="tr" style="height:30px;">
        					<xf:group tagname="th"
        						style="border:1px solid #ddd;padding:8px;background:#f2f2f2;text-align:center;width:50%;height: 30px;" class="w2tb_th">
        						구분
        						<w2:attributes>
        							<w2:scope>col</w2:scope>
        						</w2:attributes>
        					</xf:group>
        					<xf:group tagname="th"
        						style="border:1px solid #ddd;padding:8px;background:#f2f2f2;text-align:center;width:50%;height: 30px;" class="w2tb_th">
        						금액산정내용
        						<w2:attributes>
        							<w2:scope>col</w2:scope>
        						</w2:attributes>
        					</xf:group>
        				</xf:group>
        				<xf:group tagname="tr" style="">
        					<xf:group tagname="td" style="" class="w2tb_td">진료비총액</xf:group>
        					<xf:group tagname="td" style="" id="cell_total" class="w2tb_td">
        						<xf:input id="" style="width: 144px;height: 21px;" readOnly="true" readOnlyClass="readonly"></xf:input>
        					</xf:group>
        				</xf:group>
        				<xf:group tagname="tr" style="">
        					<xf:group tagname="td" style="" class="w2tb_td">환자부담총액</xf:group>
        					<xf:group tagname="td" style="" class="w2tb_td">
        						<xf:input id="" style="width: 144px;height: 21px;" readOnly="true" readOnlyClass="readonly"></xf:input>
        					</xf:group>
        				</xf:group>
        				<xf:group tagname="tr" style="">
        					<xf:group tagname="td" style="" class="w2tb_td">이미납부한금액</xf:group>
        					<xf:group tagname="td" style="" class="w2tb_td">
        						<xf:input ref="data:dm_sub.amount_paid" maxByteLength="" dataType="text" style="width: 144px;height: 21px;"
        							id="ipt_paid" ev:onchange="scwin.ipt_paid_onchange">
        						</xf:input>
        					</xf:group>
        				</xf:group>
        				<xf:group tagname="tr" style="">
        					<xf:group tagname="td" style="" class="w2tb_td">납부할금액</xf:group>
        					<xf:group tagname="td" style="" class="w2tb_td">
        						<xf:input ref="data:dm_sub.due_amt" maxByteLength="" dataType="text" style="width: 144px;height: 21px;"
        							id="">
        						</xf:input>
        					</xf:group>
        				</xf:group>
        				<xf:group tagname="tr" style="">
        					<xf:group tagname="td" style="" class="w2tb_td">납부한금액</xf:group>
        					<xf:group tagname="td" style="" class="w2tb_td">
        						<xf:input ref="data:dm_sub.due_pay" maxByteLength="" dataType="text" style="width: 144px;height: 21px;"
        							id="ipt_pay" ev:onchange="scwin.ipt_pay_onchange">
        						</xf:input>
        					</xf:group>
        				</xf:group>
        			</xf:group>
        			<xf:group class="w2tb" id="" style="width:100%;height: 100px;margin-top: 20px;" tagname="table">
        				<w2:attributes>
        					<w2:summary></w2:summary>
        				</w2:attributes>
        				<xf:group tagname="caption"></xf:group>
        				<xf:group tagname="colgroup">
        					<xf:group style="width:50.00%;" tagname="col"></xf:group>
        					<xf:group style="width:50.00%;" tagname="col"></xf:group>
        				</xf:group>
        				<xf:group style="height:30px;" tagname="tr">
        					<xf:group class="w2tb_th"
        						style="border:1px solid #ddd;padding:8px;background:#f2f2f2;text-align:center;width:50%;height: 30px;" tagname="th">
        						구분
        						<w2:attributes>
        							<w2:scope>col</w2:scope>
        						</w2:attributes>
        					</xf:group>
        					<xf:group class="w2tb_th"
        						style="border:1px solid #ddd;padding:8px;background:#f2f2f2;text-align:center;width:50%;height: 30px;" tagname="th">
        						금액산정내용
        						<w2:attributes>
        							<w2:scope>col</w2:scope>
        						</w2:attributes>
        					</xf:group>
        				</xf:group>
        				<xf:group style="" tagname="tr">
        					<xf:group class="w2tb_td" style="" tagname="td">최종수납액</xf:group>
        					<xf:group class="w2tb_td" id="" style="" tagname="td">
        						<xf:input id="ipt_fianlpay" style="width: 144px;height: 21px;" readOnly="true" ref="data:dm_result.final_due" class="" readOnlyClass="readonly"></xf:input>
        					</xf:group>
        				</xf:group>
        				<xf:group style="" tagname="tr">
        					<xf:group class="w2tb_td" style="" tagname="td">병원공제금</xf:group>
        					<xf:group class="w2tb_td" style="" tagname="td">
        						<xf:input id="ipt_hosp" style="width: 144px;height: 21px;" ref="data:dm_result.hospital_prepaid" readOnly="true" class="readonly" readOnlyClass="readonly"></xf:input>
        					</xf:group>
        				</xf:group>
        				<xf:group style="" tagname="tr">
        					<xf:group class="w2tb_td" style="" tagname="td">삭감항목총액</xf:group>
        					<xf:group class="w2tb_td" style="" tagname="td">
        						<xf:input id="ipt_excTotal" style="width: 144px;height: 21px;" ref="data:dm_result.deducation_amt" class="readonly" readOnly="true" readOnlyClass="readonly" ev:onchange="scwin.ipt_excTotal_onchange"></xf:input>
        					</xf:group>
        				</xf:group>
        				<xf:group style="" tagname="tr">
        					<xf:group class="w2tb_td" style="" tagname="td">산출금</xf:group>
        					<xf:group class="w2tb_td" style="" tagname="td">
        						<xf:input id="ipt_result" style="width: 144px;height: 21px;" ref="data:dm_result.refund_amt" class="readonly" readOnly="true" readOnlyClass="readonly"></xf:input>
        					</xf:group>
        				</xf:group>
        			</xf:group>
        		</xf:group>

        	</xf:group>
        	<xf:group class="btnbox" id="" meta_snippetCategory="08_버튼" meta_snippetKeyComponent="true" meta_snippetName="8_04 전체제어버튼"
        		style="">
        		<xf:group class="rt" id="" style="">
        			<xf:trigger class="btn_cm" id="btn_before" style="" type="button" ev:onclick="scwin.btn_before_onclick">
        				<xf:label><![CDATA[이전]]></xf:label>
        			</xf:trigger>
        			<w2:textbox class="bar_btndiv" id="" label="" style=""></w2:textbox>
        			<xf:trigger class="btn_cm pt" id="btn_next" style="" type="button" ev:onclick="scwin.btn_next_onclick">
        				<xf:label><![CDATA[다음]]></xf:label>
        			</xf:trigger>
        		</xf:group>
        	</xf:group>
        </xf:group>
    </body>
</html>
