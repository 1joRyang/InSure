<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
        	<w2:dataCollection baseNode="map">
        		<w2:dataList baseNode="list" repeatNode="map" id="dl_execlist" saveRemovedData="true">
        			<w2:columnInfo>
        				<w2:column dataType="text" name="내용" id="content"></w2:column>
        			</w2:columnInfo>
        			<w2:data use="true">
        				<w2:row>
        					<content><![CDATA[치과, 한방치료 비급여 의료비]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[국민건강보험공단으로부터 환급이 가능한 금액]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[건강검진, 예방접종, 인공유산]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[영양제, 종합비타민제, 호르몬 투여, 보신용 투약 등]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[단순피로, 권태, 여드름, 주근깨, 점, 사마귀 등]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[보조기, 보장구, 안경, 렌즈 등 진료 재료구입비]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[외모개선 목적의 치료로 인하여 발생한 의료비]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[제비용(TV시청료, 전화료, 제증명료 등)]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[산재보험에서 보상받는 의료비]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[인간면역바이러스(HIV)감염으로 인한 치료비]]></content>
        				</w2:row>
        				<w2:row>
        					<content><![CDATA[해외 소재 의료기관에서 발생한 의료비]]></content>
        				</w2:row>
        			</w2:data>
        		</w2:dataList>
        		<w2:dataMap baseNode="map" id="dm_excitems">
        			<w2:keyInfo>
        				<w2:key dataType="text" name="exc_id" id="exc_id"></w2:key>
        				<w2:key dataType="text" name="item_id" id="item_id"></w2:key>
        				<w2:key dataType="text" name="treatment_id" id="treatment_id"></w2:key>
        				<w2:key dataType="text" name="claim_no" id="claim_no"></w2:key>
        				<w2:key dataType="text" name="exc_reason" id="exc_reason"></w2:key>
        				<w2:key dataType="text" name="exc_cost" id="exc_cost"></w2:key>
        				<w2:key dataType="text" name="exc_category" id="exc_category"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        	</w2:dataCollection>
        	<w2:workflowCollection />
        	<xf:submission id="sbm_excInsert" action="/InsWebApp/EXCITEMIns.pwkjson" method="post" mediatype="application/json"
        		ref='data:json,{"id":"dm_excitems","key":"elData"}' target="" encoding="UTF-8" instance="" replace="" errorHandler=""
        		customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="" ev:submiterror="" abortTrigger="">
        	</xf:submission>
        	<xf:submission id="sbm_getExc" action="/InsWebApp/EXCITEMUpdView.pwkjson" method="post" mediatype="application/json" ref=""
        		target='data:json,{"id":"dm_excitems","key":"elData"}' encoding="UTF-8" instance="" replace="" errorHandler="" customHandler=""
        		mode="asynchronous" processMsg="로딩 중..." ev:submit="" ev:submitdone="scwin.sbm_getExc_submitdone" ev:submiterror=""
        		abortTrigger="">
        	</xf:submission>
        	<xf:submission id="sbm_excUpdate" action="/InsWebApp/EXCITEMUpd.pwkjson" method="post" mediatype="application/json" ref='data:json,{"id":"dm_excitems","key":"elData"}' target="" encoding="UTF-8"
        		instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone=""
        		ev:submiterror="" abortTrigger="">
        	</xf:submission>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function() {
    scwin.excTotal = Number(localStorage.getItem("excTotal")) || 0;
	let itemId = localStorage.getItem('itemId');
    let excId = localStorage.getItem('excId');
    let treatmentId = localStorage.getItem("treatmentId");
    let claimNo = localStorage.getItem("claimNo");

    dm_excitems.set("exc_id", excId);
    dm_excitems.set("item_id", itemId);
    dm_excitems.set("treatment_id", treatmentId);
    dm_excitems.set("claim_no", claimNo);

    $c.sbm.execute(sbm_getExc, {"elData": dm_excitems.getJSON()});
};

scwin.sbm_getExc_submitdone = function (e) {
    let cost = dm_excitems.getJSON().exc_cost
    if (cost === "") {
        btn_edit.hide();
    } else {
        btn_save.hide();
        scwin.excTotal -= Number(ipt_cost.getValue());
    }
};

scwin.btn_edit_onclick = function (e) {
    $c.sbm.execute(sbm_excUpdate);
    scwin.excTotal += Number(ipt_cost.getValue());
    $p.parent().ipt_excTotal.setValue(scwin.excTotal);
    localStorage.setItem("excTotal", scwin.excTotal);
    localStorage.setItem("exc", ipt_cost.getValue());
    $p.closePopup();
};

scwin.btn_save_onclick = function (e) {
    $c.sbm.execute(sbm_excInsert);
    scwin.excTotal += Number(ipt_cost.getValue());
    $p.parent().ipt_excTotal.setValue(scwin.excTotal);
    localStorage.setItem("excTotal", scwin.excTotal);
    localStorage.setItem("exc", ipt_cost.getValue());
    $p.closePopup();
};

scwin.grd_exec_oncellclick = function (rowIndex, columnIndex, columnId) {
    ipt_category.setValue(rowIndex + 1);
};

scwin.btn_close_onclick = function (e) {
    localStorage.removeItem("excId");
    localStorage.removeItem("itemId");
    $p.closePopup();
};


]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
    	<xf:group class="pop_contents" id="" meta_snippetCategory="00_화면시작" meta_snippetKeyComponent="true"
    		meta_snippetName="0_02 팝업페이지시작">
    		<xf:group adaptiveThreshold="" class="gvwbox" id="" meta_snippetCategory="06_그리드" meta_snippetKeyComponent="true"
    			meta_snippetName="6_02 그리드_순번_상태" style="">
    			<w2:gridView autoFit="allColumn" checkReadOnlyOnPasteEnable="" class="gvw" dataList="data:dl_execlist" focusMode="row" id="grd_exec"
    				keepDefaultColumnWidth="true" rowNumHeaderValue="No" rowNumVisible="true" rowNumWidth="50" rowStatusVisible="false"
    				rowStatusWidth="50" scrollByColumn="false" scrollByColumnAdaptive="false" style="height: 350px;" ev:oncellclick="scwin.grd_exec_oncellclick">
    				<w2:caption id="caption2" style="" value="this is a grid caption."></w2:caption>
    				<w2:header id="header2" style="">
    					<w2:row id="row3" style="">
    						<w2:column removeBorderStyle="false" width="70" inputType="text" id="column10" value="내용" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    					</w2:row>
    				</w2:header>
    				<w2:gBody id="gBody2" style="">
    					<w2:row id="row4" style="">
    						<w2:column removeBorderStyle="false" width="70" inputType="text" id="content" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    					</w2:row>
    				</w2:gBody>
    			</w2:gridView>
    		</xf:group>
    		<xf:group class="lybox" id="" meta_snippetCategory="01_화면분할" meta_snippetKeyComponent="true"
    			meta_snippetName="1_03 가변 3단 분할_width값 고정 33per" style="">
    			<xf:group style="" id="" class="">
    				<w2:textbox style="width: 150px;height: 23px;" id="" label="카테고리"></w2:textbox>
    				<xf:input ref="data:dm_excitems.exc_category" meta_snippetCategory="10_입력폼" meta_snippetName="10_07 Inputbox_100per"
    					meta_snippetKeyComponent="true" style="width:100%;" id="ipt_category" placeholder="" class="">
    				</xf:input>
    			</xf:group>
    			<xf:group class="" id="" style="">
    				<w2:textbox style="width: 150px;height: 23px;" id="" label="사유"></w2:textbox>
    				<xf:input class="" id="ipt_reason" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    					meta_snippetName="10_07 Inputbox_100per" placeholder="" style="width:100%;" ref="data:dm_excitems.exc_reason">
    				</xf:input>
    			</xf:group>
    			<xf:group class="" id="" style="">
    				<w2:textbox style="width: 150px;height: 23px;" id="" label="금액"></w2:textbox>
    				<xf:input class="" id="ipt_cost" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    					meta_snippetName="10_07 Inputbox_100per" placeholder="" style="width:100%;" ref="data:dm_excitems.exc_cost" displayFormat="##,###,###,###">
    				</xf:input>
    			</xf:group>
    		</xf:group>
    		<xf:group class="btnbox" id="" meta_snippetCategory="08_버튼" meta_snippetKeyComponent="true" meta_snippetName="8_05 팝업전체제어버튼"
    			style="margin-top: 50px">
    			<xf:group class="rt" id="" style="">
    				<xf:trigger style="" id="btn_close" type="button" class="btn_cm " ev:onclick="scwin.btn_close_onclick">
    					<xf:label><![CDATA[취소]]></xf:label>
    				</xf:trigger>
    				<xf:trigger class="btn_cm pt" id="btn_save" style="" type="button" ev:onclick="scwin.btn_save_onclick">
    					<xf:label><![CDATA[저장]]></xf:label>
    				</xf:trigger>
    				<xf:trigger class="btn_cm pt" id="btn_edit" style="" type="button" ev:onclick="scwin.btn_edit_onclick">
    					<xf:label><![CDATA[저장]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    		</xf:group>
    	</xf:group>
    </body>
</html>
