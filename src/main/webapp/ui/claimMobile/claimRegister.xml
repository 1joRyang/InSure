<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/InsWebApp/cm/css/claimPage.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
            <w2:dataCollection baseNode="map">
                <w2:dataMap id="claimData">
                    <w2:keyInfoList>
                        <w2:keyInfo id="claimType" dataType="text"></w2:keyInfo>
                    </w2:keyInfoList>
                </w2:dataMap>
                <w2:dataList id="uploadedImages" baseNode="list" repeatNode="map">
                    <w2:columnInfo>
                        <w2:column id="id" name="이미지ID" dataType="text"></w2:column>
                        <w2:column id="src" name="이미지경로" dataType="text"></w2:column>
                        <w2:column id="name" name="파일명" dataType="text"></w2:column>
                    </w2:columnInfo>
                </w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <w2:layout css="true" src="/css/custom.css"></w2:layout>
        <script lazy="false" type="text/javascript"><![CDATA[
            scwin.onpageload = function() {
                // 페이지 로드 시 초기화 로직
                // 이전 페이지에서 넘어온 데이터가 있다면 처리
                // 예: $p.get("claimData").set("claimType", $p.getParam("claimType"));

                // 초기에는 첨부된 이미지가 없으므로 DataList를 비워둠
                uploadedImages.removeAll();

                // 첨부내역 메시지 표시
                scwin.updateUploadedImagesView();
            };

            // '맞춤 서류 안내' 클릭 이벤트 (팝업 등을 띄울 수 있음)
            scwin.onClickGuide = function() {
                alert("맞춤 서류 안내 팝업을 띄웁니다.");
                // 실제 팝업 연동 로직
                // $p.openPopup("/path/to/guidePopup.xml", {
                //      width: 400,
                //      height: 500,
                //      modal: true
                // });
            };

            // '카메라 촬영' 클릭 이벤트
            scwin.onClickCamera = function() {
                alert("카메라 촬영 기능을 호출합니다.");
                // 실제 모바일 카메라 연동 로직 (WebSquare5의 Mobile API 또는 Cordova/Ionic 연동 필요)
                // 예: $w.web.camera.captureImage({
                //      success: function(imageUrl) {
                //          scwin.addUploadedImage(imageUrl);
                //      },
                //      fail: function(error) {
                //          console.error("카메라 촬영 실패:", error);
                //          alert("카메라 촬영에 실패했습니다.");
                //      }
                // });
                // 테스트를 위해 임의 이미지 추가
                scwin.addUploadedImage("https://via.placeholder.com/80?text=Camera" + (uploadedImages.getRowCount() + 1));
            };

            // '내 휴대폰 사진' 클릭 이벤트
            scwin.onClickAlbum = function() {
                alert("휴대폰 앨범 기능을 호출합니다.");
                // 실제 모바일 앨범 연동 로직 (WebSquare5의 Mobile API 또는 Cordova/Ionic 연동 필요)
                // 예: $w.web.file.pick({
                //      mimeType: "image/*",
                //      multi: true, // 여러 장 선택 가능
                //      success: function(imageUrls) {
                //          imageUrls.forEach(function(url) {
                //              scwin.addUploadedImage(url);
                //          });
                //      },
                //      fail: function(error) {
                //          console.error("앨범 선택 실패:", error);
                //          alert("앨범 선택에 실패했습니다.");
                //      }
                // });
                // 테스트를 위해 임의 이미지 추가
                scwin.addUploadedImage("https://via.placeholder.com/80?text=Album" + (uploadedImages.getRowCount() + 1));
            };

            // 이미지 미리보기 DataList에 이미지 추가
            scwin.addUploadedImage = function(imageUrl) {
                var newId = "img" + Date.now(); // 고유 ID 생성
                uploadedImages.addRow();
                uploadedImages.setRowData($p.lastRow(), {
                    id: newId,
                    src: imageUrl,
                    name: "사진" + uploadedImages.getRowCount() + ".jpg" // 임의 파일명
                });
                scwin.updateUploadedImagesView(); // 데이터 변경 후 UI 업데이트
            };

            // 이미지 삭제
            scwin.deleteUploadedImage = function(rowIdx) {
                if (confirm("이 이미지를 삭제하시겠습니까?")) {
                    uploadedImages.deleteRow(rowIdx);
                    scwin.updateUploadedImagesView(); // 데이터 변경 후 UI 업데이트
                }
            };

            // 첨부된 이미지 유무에 따라 미리보기 영역/메시지 토글 및 이미지 직접 렌더링
            scwin.updateUploadedImagesView = function() {
                
            };

            // '다음' 버튼 클릭 이벤트
            scwin.onClickNext = function() {
                // 첨부된 파일이 있는지 검증 (필요하다면)
                if (uploadedImages.getRowCount() === 0) {
                    alert("청구 서류를 1장 이상 등록해주세요.");
                    return;
                }

                alert("다음 화면으로 이동!");
                // 다음 화면으로 이동 로직
                // $p.open("/path/to/nextPage.xml", {
                //      "param": {
                //          "uploadedFiles": uploadedImages.getAllJSON() // 첨부된 파일 목록 전달
                //      }
                // });
            };
        ]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
        <xf:group class="sub_contents" id="wrapper">
            <xf:group class="header-section" id="header">
                <w2:textbox class="step_tit" id="" label="서류등록"></w2:textbox>
                <xf:group class="step" id="">
                    <xf:group id="" tagname="ul">
                        <xf:group class="checked" id="" tagname="li">
                            <w2:span id="" label="✔"></w2:span>
                        </xf:group>
                        <xf:group class="checked" id="" tagname="li">
                            <w2:span id="" label="✔"></w2:span>
                        </xf:group>
                        <xf:group class="checked" id="" tagname="li">
                            <w2:span id="" label="✔"></w2:span>
                        </xf:group>
                        <xf:group class="current" id="" tagname="li">
                            <w2:span id="" label="4"></w2:span>
                        </xf:group>
                        <xf:group class="inactive" id="" tagname="li">
                            <w2:span id="" label="5"></w2:span>
                        </xf:group>
                        <xf:group class="inactive" id="" tagname="li">
                            <w2:span id="" label="6"></w2:span>
                        </xf:group>
                        <xf:group class="inactive" id="" tagname="li">
                            <w2:span id="" label="7"></w2:span>
                        </xf:group>
                    </xf:group>
                </xf:group>
            </xf:group>

            <xf:group class="content-section" id="mainContent">
                <w2:textbox class="question-text" id="" label="임소희님 준비하신 서류를 등록해 주세요"></w2:textbox>

                <xf:group class="guide-button" id="btnGuide" ev:onclick="scwin.onClickGuide()">
                    <xf:image src="/images/icon_search_magnifier.png" class="icon"></xf:image> <w2:textbox id="" label="맞춤 서류 안내"></w2:textbox>
                </xf:group>

                <w2:textbox class="section-title first" id="" label="청구서류 등록"></w2:textbox>
                <xf:group class="yn-cbutton-container" id="uploadButtons">
                    <xf:group class="yn-cbutton" id="btnCamera" ev:onclick="scwin.onClickCamera()">
                        <xf:image src="/images/icon_camera.png" class="icon"></xf:image> <w2:textbox id="" label="카메라&lt;br/&gt;촬영"></w2:textbox>
                    </xf:group>
                    <xf:group class="yn-cbutton" id="btnAlbum" ev:onclick="scwin.onClickAlbum()">
                        <xf:image src="/images/icon_album.png" class="icon"></xf:image> <w2:textbox id="" label="내 휴대폰&lt;br/&gt;사진"></w2:textbox>
                    </xf:group>
                </xf:group>

                <w2:textbox class="section-title" id="" label="청구서류 첨부내역"></w2:textbox>

                <xf:group class="no-documents-message" id="noDocumentsMessage">
                    <xf:image src="/images/icon_warning_triangle.png" class="warning-icon"></xf:image> <w2:textbox id="" label="등록된 청구서류가 없습니다."></w2:textbox>
                </xf:group>

                <xf:group class="uploaded-image-preview-container" id="uploadedImagePreviewArea" style="display:none;">
                    </xf:group>

                <xf:group class="info-box" id="infoBox">
                    <w2:textbox class="info-box-title" id="" label="유의사항">
                        <xf:image src="/images/icon_exclamation.png" class="icon"></xf:image> </w2:textbox>
                    <xf:group class="info-item" id="">
                        <xf:image src="/images/icon_file_plus.png" class="icon"></xf:image> <w2:textbox id="" label="파일 10장씩, 최대 30장까지"></w2:textbox>
                    </xf:group>
                    <xf:group class="info-item" id="">
                        <xf:image src="/images/icon_image_plus.png" class="icon"></xf:image> <w2:textbox id="" label="확장자가 JPG, JPEG, PNG 파일만 등록"></w2:textbox>
                    </xf:group>
                    <xf:group class="info-item" id="">
                        <xf:image src="/images/icon_clipboard_check.png" class="icon"></xf:image> <w2:textbox id="" label="비급여 금액 <span class='link-text' ev:onclick='scwin.onClickNonBenefitLink()'>진료비세부내역서</span> 필수 제출"></w2:textbox>
                    </xf:group>
                </xf:group>

                <w2:textbox class="example-section-title" id="" label="올바른 예시"></w2:textbox>
                <xf:group class="example-images-container" id="correctExamples">
                    <xf:group class="example-image-item">
                        <xf:image src="/images/correct_example_1.png" class="example-img"></xf:image>
                        <w2:textbox class="example-caption" id="" label="진료비 계산서 영수증"></w2:textbox>
                    </xf:group>
                    <xf:group class="example-image-item">
                        <xf:image src="/images/correct_example_2.png" class="example-img"></xf:image>
                        <w2:textbox class="example-caption" id="" label="약제비 계산서 영수증"></w2:textbox>
                    </xf:group>
                </xf:group>

                <w2:textbox class="example-section-title" id="" label="잘못된 예시"></w2:textbox>
                <xf:group class="example-images-container" id="incorrectExamples">
                    <xf:group class="example-image-item">
                        <xf:image src="/images/incorrect_example_1.png" class="example-img"></xf:image>
                        <w2:textbox class="example-caption" id="" label="카드매출전표"></w2:textbox>
                    </xf:group>
                    <xf:group class="example-image-item">
                        <xf:image src="/images/incorrect_example_2.png" class="example-img"></xf:image>
                        <w2:textbox class="example-caption" id="" label="진료비 납입 확인서"></w2:textbox>
                    </xf:group>
                </xf:group>
            </xf:group>

            <xf:group class="footer-section" id="footer">
                <w2:button class="next-button" id="btnNext" label="다음" ev:onclick="scwin.onClickNext()"></w2:button>
            </xf:group>
        </xf:group>
    </body>
</html>