<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
        	<w2:dataCollection baseNode="map">
        	<!-- 청구와 직원 조인 조회용 데이터맵 추가 -->
        	<w2:dataMap baseNode="map" id="dmp_claimEmployeeVo">
        	<w2:keyInfo>
        	<w2:key dataType="text" name="search_claim_type" id="SC_claim_type"></w2:key>
        	<w2:key dataType="text" name="search_status" id="SC_status"></w2:key>
        	<w2:key dataType="text" name="search_emp_name" id="SC_emp_name"></w2:key>
        	<w2:key nullYN="" defaultValue="1" dataType="text" name="페이지번호" length="" id="pageIndex" encYN=""></w2:key>
        	 <w2:key nullYN="" defaultValue="10" dataType="text" name="페이지사이즈" length="" id="pageSize" encYN=""></w2:key>
        	  <w2:key dataType="text" name="페이지건수" id="totalPageCount"></w2:key>
        	 </w2:keyInfo>
        	</w2:dataMap>
        	
        	<!-- 청구와 직원 조인 결과 리스트 추가 -->
        	<w2:dataList baseNode="list" repeatNode="map" id="dlt_claimEmployeeList" saveRemovedData="true">
        	<w2:columnInfo>
        	<w2:column dataType="text" name="claim_no" id="claim_no"></w2:column>
        	<w2:column dataType="text" name="claim_type" id="claim_type"></w2:column>
        	<w2:column dataType="text" name="emp_name" id="emp_name"></w2:column>
        	<w2:column dataType="text" name="status" id="status"></w2:column>
        	<w2:column dataType="text" name="receipt_date" id="receipt_date"></w2:column>
        	<w2:column dataType="text" name="emp_no" id="emp_no"></w2:column>
        	<w2:column dataType="text" name="claim_content" id="claim_content"></w2:column>
        	</w2:columnInfo>
        	</w2:dataList>
        	
        	<!-- 기존 데이터맵 유지 -->
        	<w2:dataMap baseNode="map" id="dmp_claimVo">
        	<w2:keyInfo>
        	<w2:key dataType="text" name="search_receipt_date" id="SC_receipt_date"></w2:key>
        	 <w2:key nullYN="" defaultValue="" dataType="text" name="search_ID" length="" id="SC_ID" encYN=""></w2:key>
        	  <w2:key nullYN="" defaultValue="1" dataType="text" name="페이지번호" length="" id="pageIndex" encYN=""></w2:key>
        	   <w2:key nullYN="" defaultValue="10" dataType="text" name="페이지사이즈" length="" id="pageSize" encYN=""></w2:key>
					<w2:key dataType="text" name="페이지건수" id="totalPageCount"></w2:key>
				</w2:keyInfo>
			</w2:dataMap>
			<w2:dataList baseNode="list" repeatNode="map" id="dlt_claimVoList" saveRemovedData="true">
				<w2:columnInfo>
					<w2:column dataType="text" name="claim_no" id="claim_no"></w2:column>
					<w2:column defaultValue="" dataType="text" name="claim_type" length="" id="claim_type" encYN="" ignoreStatus=""></w2:column>
					<w2:column defaultValue="" dataType="text" name="receipt_date" length="" id="receipt_date" encYN=""
						ignoreStatus="">
					</w2:column>
					<w2:column defaultValue="" dataType="text" name="status" length="" id="status" encYN="" ignoreStatus=""></w2:column>
					<w2:column defaultValue="" dataType="text" name="emp_no" length="" id="emp_no" encYN="" ignoreStatus=""></w2:column>
					<w2:column defaultValue="" dataType="text" name="ID" length="" id="ID" encYN="" ignoreStatus=""></w2:column>
					<w2:column defaultValue="" dataType="text" name="claim_content" length="" id="claim_content" encYN=""
						ignoreStatus="">
					</w2:column>
					<w2:column defaultValue="" dataType="text" name="disease_code" length="" id="disease_code" encYN=""
						ignoreStatus="">
					</w2:column>
					<w2:column dataType="text" name="date_of_accident" id="date_of_accident"></w2:column>
				</w2:columnInfo>
			</w2:dataList>
		</w2:dataCollection>
        	<w2:workflowCollection />
        	
        	<!-- 기존 청구 목록 조회 서브미션 -->
        	<xf:submission id="sbm_claimList" action="/InsWebApp/CLAIMList.pwkjson" method="post" mediatype="application/json" ref='data:json,{"id":"dmp_claimVo","key":"claimVo"}' target='data:json,{"id":"dlt_claimVoList","key":"elData.claimVoList"}' encoding="UTF-8"
        	 instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_claimList_submitdone"
			ev:submiterror="" abortTrigger="">
		</xf:submission>
		
		<!-- 청구-직원 조인 조회 서브미션 추가 -->
		<xf:submission id="sbm_claimEmployeeList" action="/InsWebApp/CLAIMEmployeeList.pwkjson" method="post" mediatype="application/json" 
			ref='data:json,{"id":"dmp_claimEmployeeVo","key":"claimEmployeeVo"}' 
			target='data:json,{"id":"dlt_claimEmployeeList","key":"claimEmployeeVoList"}' 
			encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" 
			processMsg="청구-직원 정보를 조회 중입니다..." 
			ev:submit="" ev:submitdone="scwin.sbm_claimEmployeeList_submitdone" 
			ev:submiterror="scwin.sbm_claimEmployeeList_submiterror" abortTrigger="">
		</xf:submission>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = async function() {
    console.log("페이지 로드 시작");
    
    // 기본적으로 청구-직원 조인 데이터를 조회
    scwin.searchClaimEmployee();
    
    // 기존 청구 목록도 조회 (비교용)
    await $c.sbm.execute($p, sbm_claimList);
};

// 청구-직원 조인 조회 함수
scwin.searchClaimEmployee = function() {
    console.log("청구-직원 조인 조회 시작");
    
    
    // 서브미션 실행
    $c.sbm.execute($p, sbm_claimEmployeeList);
};

// 청구-직원 조인 조회 성공 콜백
scwin.sbm_claimEmployeeList_submitdone = function(e) {
    console.log("=== 청구-직원 조인 조회 완료 ===");
    console.log("응답 데이터:", e);
    
    var resultCount = dlt_claimEmployeeList.getRowCount();
    console.log("조회된 데이터 수:", resultCount);
    
    // 총 건수 표시
    if (spn_totalCount) {
        spn_totalCount.setValue(resultCount + "건");
    }
    
    console.log("데이터 바인딩 성공 - 총 " + resultCount + "건");
};

// 청구-직원 조인 조회 실패 콜백
scwin.sbm_claimEmployeeList_submiterror = function(e) {
    console.error("=== 청구-직원 조인 조회 오류 ===");
    console.error("오류:", e);
    alert("청구-직원 데이터 조회 중 오류가 발생했습니다: " + (e.responseText || "알 수 없는 오류"));
};

// 청구-직원 조인 재조회 버튼 이벤트
scwin.btn_searchJoin_onclick = function() {
    console.log("청구-직원 조인 재조회 시작");
    scwin.searchClaimEmployee();
};


// 기존 함수 (호환성 유지)
scwin.sbm_claimList_submitdone = function(e) {
    console.log("기존 청구 목록 조회 완료:", e);
};

// 그리드 더블클릭 이벤트 (상세 조회용)
scwin.grd_claimEmployee_ondblclick = function(row, col) {
    try {
        var selectedData = dlt_claimEmployeeList.getRowJSON(row);
        console.log("선택된 청구 정보:", selectedData);
        
        if (selectedData && selectedData.claim_no) {
            var detailMsg = "청구번호: " + (selectedData.claim_no || "없음") + "\n" +
                          "청구유형: " + (selectedData.claim_type || "없음") + "\n" +
                          "직원명: " + (selectedData.emp_name || "없음") + "\n" +
                          "상태: " + (selectedData.status || "없음");
            
            if (selectedData.receipt_date) {
                detailMsg += "\n접수일자: " + selectedData.receipt_date;
            }
            if (selectedData.claim_content) {
                detailMsg += "\n청구내용: " + selectedData.claim_content;
            }
            
            alert(detailMsg);
        } else {
            alert("선택된 행의 데이터가 없습니다.");
        }
    } catch (error) {
        console.error("그리드 클릭 이벤트 오류:", error);
        alert("데이터 조회 중 오류가 발생했습니다.");
    }
};

// 디버깅용 함수 - 수동 호출 가능
scwin.debugData = function() {
    console.log("=== 디버깅 정보 ===");
    console.log("dmp_claimEmployeeVo:", dmp_claimEmployeeVo.getJSON());
    console.log("dlt_claimEmployeeList 행 수:", dlt_claimEmployeeList.getRowCount());
    console.log("dlt_claimEmployeeList 데이터:", dlt_claimEmployeeList.getJSON());
};]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
    	<xf:group class="sub_contents" id="" meta_snippetCategory="00_화면시작" meta_snippetKeyComponent="true" meta_snippetName="0_01 페이지시작"
    		style="">
    		<xf:group class="pgtbox" id="" meta_snippetCategory="02_타이틀" meta_snippetKeyComponent="true" meta_snippetName="2_01 페이지타이틀"
    			style="">
    			<xf:group id=""></xf:group>
    			<w2:textbox class="pgt_tit" id="" label="청구번호 조회" style="" tagname="h2"></w2:textbox>
    		</xf:group>

    		<!-- 검색 조건 영역 -->

    		<!-- 조회 결과 표시 영역 -->
    		<hr style="width: 100% border:none; border-top:2px solid #ddd; margin: 20px;"></hr>
    		<xf:group id="">
    			<w2:span meta_snippetCategory="10_입력폼" meta_snippetName="10_16 출력텍스트" meta_snippetKeyComponent="true" style="" id=""
    				label="청구번호">
    			</w2:span>
    		</xf:group>
    		<xf:group id="">
    			<xf:input meta_snippetCategory="10_입력폼" meta_snippetName="10_10 InputBox_조회버튼" meta_snippetKeyComponent="true"
    				style="width:150px;" id="" placeholder="" class="">
    			</xf:input>
    			<xf:trigger class="btn_cm" id="btn_search" meta_snippetCategory="08_버튼" meta_snippetKeyComponent="true" meta_snippetName="8_01 기본버튼"
    				style="background-color: #95d782" type="button">
    				<xf:label><![CDATA[검색]]></xf:label>
    			</xf:trigger>
    		</xf:group>
    		<xf:group id="" style="margin-bottom:10px;">
    			<w2:textbox id="" label="청구 목록" style="font-weight:bold; display:inline-block; margin-right:10px;"></w2:textbox>
    			<w2:span id="spn_totalCount" label="0건" style="color:#666; font-size:12px;"></w2:span>
    		</xf:group>

    		<!-- 청구-직원 조인 그리드 -->
    		<xf:group adaptiveThreshold="" class="gvwbox" id="" style="">
    			<w2:gridView autoFit="allColumn" checkReadOnlyOnPasteEnable="" class="gvw" dataList="data:dlt_claimEmployeeList"
    				focusMode="row" id="grd_claimEmployee" scrollByColumn="false" scrollByColumnAdaptive="false" style="height: 300px;"
    				ev:ondblclick="scwin.grd_claimEmployee_ondblclick">
    				<w2:caption id="caption1" style="" value="청구-직원 조인 정보 그리드"></w2:caption>
    				<w2:header id="header1" style="">
    					<w2:row id="row1" style="">
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="column1" value="청구번호"
    							blockSelect="false" displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="120" inputType="text" id="column2" value="청구유형"
    							blockSelect="false" displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="column3" value="직원이름"
    							blockSelect="false" displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="80" inputType="text" id="column4" value="상태" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    					</w2:row>
    				</w2:header>
    				<w2:gBody id="gBody1" style="">
    					<w2:row id="row2" style="">
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="claim_no" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="120" inputType="text" id="claim_type" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="emp_name" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="80" inputType="text" id="status" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    					</w2:row>
    				</w2:gBody>
    			</w2:gridView>
    		</xf:group>

    		<!-- 구분선 -->

    		<!-- 기존 청구 목록 (비교용) -->
    	</xf:group>
    </body>
</html>
