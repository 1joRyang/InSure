<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
        	<w2:dataCollection baseNode="map">
        	
        	<!-- 전체 조인 조회용 데이터맵 - claim_no만 검색 -->
        	<w2:dataMap baseNode="map" id="dmp_claimFullJoinVo">
        	<w2:keyInfo>
        	<!-- 기존 검색 조건들 제거하고 claim_no만 유지 -->
        	<w2:key dataType="text" name="claim_no" id="claim_no"></w2:key>
        	<w2:key nullYN="" defaultValue="1" dataType="text" name="페이지번호" length="" id="pageIndex" encYN=""></w2:key>
        	 <w2:key nullYN="" defaultValue="10" dataType="text" name="페이지사이즈" length="" id="pageSize" encYN=""></w2:key>
        	  <w2:key dataType="text" name="페이지건수" id="totalPageCount"></w2:key>
        	 </w2:keyInfo>
        	</w2:dataMap>
        	
        	<!-- 전체 조인 결과 리스트 -->
        	<w2:dataList baseNode="list" repeatNode="map" id="dlt_claimFullJoinList" saveRemovedData="true">
        	<w2:columnInfo>
        	<w2:column dataType="text" name="claim_no" id="claim_no"></w2:column>
        	<w2:column dataType="text" name="claim_type" id="claim_type"></w2:column>
        	<w2:column dataType="text" name="user_name" id="user_name"></w2:column>
        	<w2:column dataType="text" name="amount" id="amount"></w2:column>
        	<w2:column dataType="text" name="emp_name" id="emp_name"></w2:column>
        	<w2:column dataType="text" name="status" id="status"></w2:column>
        	</w2:columnInfo>
        	</w2:dataList>
        	
        	<!-- 기존 데이터맵들 유지 (호환성을 위해) -->
        	<w2:dataMap baseNode="map" id="dmp_claimEmployeeVo">
        	<w2:keyInfo>
        	<w2:key dataType="text" name="search_claim_type" id="SC_claim_type"></w2:key>
        	<w2:key dataType="text" name="search_status" id="SC_status"></w2:key>
        	<w2:key dataType="text" name="search_emp_name" id="SC_emp_name"></w2:key>
        	<w2:key nullYN="" defaultValue="1" dataType="text" name="페이지번호" length="" id="pageIndex" encYN=""></w2:key>
        	 <w2:key nullYN="" defaultValue="10" dataType="text" name="페이지사이즈" length="" id="pageSize" encYN=""></w2:key>
        	  <w2:key dataType="text" name="페이지건수" id="totalPageCount"></w2:key>
        	 </w2:keyInfo>
        	</w2:dataMap>
        	
        	<w2:dataList baseNode="list" repeatNode="map" id="dlt_claimEmployeeList" saveRemovedData="true">
        	<w2:columnInfo>
        	<w2:column dataType="text" name="claim_no" id="claim_no"></w2:column>
        	<w2:column dataType="text" name="claim_type" id="claim_type"></w2:column>
        	<w2:column dataType="text" name="emp_name" id="emp_name"></w2:column>
        	<w2:column dataType="text" name="status" id="status"></w2:column>
        	<w2:column dataType="text" name="receipt_date" id="receipt_date"></w2:column>
        	<w2:column dataType="text" name="emp_no" id="emp_no"></w2:column>
        	<w2:column dataType="text" name="claim_content" id="claim_content"></w2:column>
        	</w2:columnInfo>
        	</w2:dataList>
        	
        	<w2:dataMap baseNode="map" id="dmp_claimVo">
        	<w2:keyInfo>
        	<w2:key dataType="text" name="search_receipt_date" id="SC_receipt_date"></w2:key>
        	 <w2:key nullYN="" defaultValue="" dataType="text" name="search_ID" length="" id="SC_ID" encYN=""></w2:key>
        	  <w2:key nullYN="" defaultValue="1" dataType="text" name="페이지번호" length="" id="pageIndex" encYN=""></w2:key>
        	   <w2:key nullYN="" defaultValue="10" dataType="text" name="페이지사이즈" length="" id="pageSize" encYN=""></w2:key>
					<w2:key dataType="text" name="페이지건수" id="totalPageCount"></w2:key>
				</w2:keyInfo>
			</w2:dataMap>
			<w2:dataList baseNode="list" repeatNode="map" id="dlt_claimVoList" saveRemovedData="true">
				<w2:columnInfo>
					<w2:column dataType="text" name="claim_no" id="claim_no"></w2:column>
					<w2:column defaultValue="" dataType="text" name="claim_type" length="" id="claim_type" encYN="" ignoreStatus=""></w2:column>
					<w2:column defaultValue="" dataType="text" name="receipt_date" length="" id="receipt_date" encYN=""
						ignoreStatus="">
					</w2:column>
					<w2:column defaultValue="" dataType="text" name="status" length="" id="status" encYN="" ignoreStatus=""></w2:column>
					<w2:column defaultValue="" dataType="text" name="emp_no" length="" id="emp_no" encYN="" ignoreStatus=""></w2:column>
					<w2:column defaultValue="" dataType="text" name="ID" length="" id="ID" encYN="" ignoreStatus=""></w2:column>
					<w2:column defaultValue="" dataType="text" name="claim_content" length="" id="claim_content" encYN=""
						ignoreStatus="">
					</w2:column>
					<w2:column defaultValue="" dataType="text" name="disease_code" length="" id="disease_code" encYN=""
						ignoreStatus="">
					</w2:column>
					<w2:column dataType="text" name="date_of_accident" id="date_of_accident"></w2:column>
				</w2:columnInfo>
			</w2:dataList>
		</w2:dataCollection>
        	<w2:workflowCollection />
        	
        	<!-- 기존 청구 목록 조회 서브미션 -->
        	<xf:submission id="sbm_claimList" action="/InsWebApp/CLAIMList.pwkjson" method="post" mediatype="application/json" ref='data:json,{"id":"dmp_claimVo","key":"claimVo"}' target='data:json,{"id":"dlt_claimVoList","key":"elData.claimVoList"}' encoding="UTF-8"
        	 instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_claimList_submitdone"
			ev:submiterror="" abortTrigger="">
		</xf:submission>
		
		<!-- 청구-직원 조인 조회 서브미션 -->
		<xf:submission id="sbm_claimEmployeeList" action="/InsWebApp/CLAIMEmployeeList.pwkjson" method="post" mediatype="application/json" 
			ref='data:json,{"id":"dmp_claimEmployeeVo","key":"claimEmployeeVo"}' 
			target='data:json,{"id":"dlt_claimEmployeeList","key":"claimEmployeeVoList"}' 
			encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" 
			processMsg="청구-직원 정보를 조회 중입니다..." 
			ev:submit="" ev:submitdone="scwin.sbm_claimEmployeeList_submitdone" 
			ev:submiterror="scwin.sbm_claimEmployeeList_submiterror" abortTrigger="">
		</xf:submission>
		
		<!-- 전체 조인 조회 서브미션 -->
		<xf:submission id="sbm_claimFullJoinList" action="/InsWebApp/CLAIMFullJoinList.pwkjson" method="post" mediatype="application/json" 
			ref='data:json,{"id":"dmp_claimFullJoinVo","key":"claimFullJoinVo"}' 
			target='data:json,{"id":"dlt_claimFullJoinList","key":"claimFullJoinVoList"}' 
			encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" 
			processMsg="청구 정보를 조회 중입니다..." 
			ev:submit="" ev:submitdone="scwin.sbm_claimFullJoinList_submitdone" 
			ev:submiterror="scwin.sbm_claimFullJoinList_submiterror" abortTrigger="">
		</xf:submission>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = async function() {
    console.log("페이지 로드 시작");
    
    // 기본적으로 전체 조회 (청구번호 없이)
    scwin.searchClaimByNo();
    
    // 기존 청구 목록도 조회 (비교용)
    await $c.sbm.execute($p, sbm_claimList);
};

// 청구번호로 검색하는 함수 (수정됨)
scwin.searchClaimByNo = function() {
    console.log("청구번호 검색 시작");
    
    // input_search 값 가져오기
    var claimNo = input_search.getValue();
    
    console.log("검색할 청구번호:", claimNo);
    
    // 청구번호가 있으면 설정, 없으면 전체 조회
    if (claimNo && claimNo.trim() !== "") {
        dmp_claimFullJoinVo.set("claim_no", claimNo.trim());
        console.log("청구번호 '" + claimNo.trim() + "'로 검색 실행");
    } else {
        dmp_claimFullJoinVo.set("claim_no", "");
        console.log("전체 조회 실행");
    }
    
    // 페이징 초기화
    dmp_claimFullJoinVo.set("pageIndex", "1");
    
    // 서브미션 실행
    $c.sbm.execute($p, sbm_claimFullJoinList);
};



// 페이징 처리
scwin.changePage = function(page) {
    dmp_claimFullJoinVo.set("pageIndex", page);
    scwin.searchClaimByNo();
};

// 정렬 기능
scwin.sortGrid = function(field, order) {
    dmp_claimFullJoinVo.set("sortField", field);
    dmp_claimFullJoinVo.set("sortOrder", order);
    scwin.searchClaimByNo();
};

// 전체 조인 조회 성공 콜백 (수정됨)
scwin.sbm_claimFullJoinList_submitdone = function(e) {
    var resultCount = dlt_claimFullJoinList.getRowCount();
    var claimNo = input_search.getValue();
    
    console.log("조회 완료 - 총 " + resultCount + "건");
    
    if (claimNo && claimNo.trim() !== "") {
        console.log("청구번호 '" + claimNo + "'로 " + resultCount + "건 조회됨");
        
        // 검색 결과가 없을 때 사용자에게 알림
        if (resultCount === 0) {
        }
    } else {
        console.log("전체 데이터 " + resultCount + "건 조회됨");
    }
};

// 전체 조인 조회 실패 콜백
scwin.sbm_claimFullJoinList_submiterror = function(e) {
    console.error("조회 실패:", e);
    alert("데이터 조회 중 오류가 발생했습니다.");
};

// 검색 버튼 이벤트 (수정됨)
scwin.btn_search_onclick = function() {
    console.log("검색 버튼 클릭");
    scwin.searchClaimByNo();
};

// 초기화 버튼 이벤트 (수정됨)
scwin.btn_reset_onclick = function() {
    console.log("검색 초기화");
    
    // 입력 필드 초기화
    input_search.setValue("");
    
    // 데이터맵 검색 조건 초기화
    dmp_claimFullJoinVo.set("claim_no", "");
    
    // 전체 조회 실행
    scwin.searchClaimByNo();
};

// 기존 함수 (호환성 유지)
scwin.sbm_claimList_submitdone = function(e) {
    console.log("기존 청구 목록 조회 완료:", e);
};

// 전체 조인 그리드 더블클릭 이벤트 (상세 조회용)
scwin.grd_claimFullJoin_ondblclick = function(row, col) {
    try {
        var selectedData = dlt_claimFullJoinList.getRowJSON(row);
        console.log("선택된 전체 청구 정보:", selectedData);
        
        if (selectedData && selectedData.claim_no) {
            var detailMsg = "청구번호: " + (selectedData.claim_no || "없음") + "\n" +
                          "청구유형: " + (selectedData.claim_type || "없음") + "\n" +
                          "사용자명: " + (selectedData.user_name || "없음") + "\n" +
                          "지급금액: " + (selectedData.amount || "없음") + "\n" +
                          "담당직원: " + (selectedData.emp_name || "없음") + "\n" +
                          "상태: " + (selectedData.status || "없음");
            
            alert(detailMsg);
        } else {
        }
    } catch (error) {
        console.error("그리드 클릭 이벤트 오류:", error);
    }
};

// 그리드 더블클릭 이벤트 (상세 조회용)
scwin.grd_claimEmployee_ondblclick = function(row, col) {
    try {
        var selectedData = dlt_claimFullJoinList.getRowJSON(row);
        console.log("선택된 청구 정보:", selectedData);
        
        if (selectedData && selectedData.claim_no) {
            var detailMsg = "청구번호: " + (selectedData.claim_no || "없음") + "\n" +
                          "청구유형: " + (selectedData.claim_type || "없음") + "\n" +
                          "고객명: " + (selectedData.user_name || "없음") + "\n" +
                          "지급금액: " + (selectedData.amount || "없음") + "\n" +
                          "담당직원: " + (selectedData.emp_name || "없음") + "\n" +
                          "상태: " + (selectedData.status || "없음");
            
            alert(detailMsg);
        } else {
        }
    } catch (error) {
        console.error("그리드 클릭 이벤트 오류:", error);
    }
};

// 디버깅용 함수 - 수동 호출 가능
scwin.debugData = function() {
    console.log("=== 디버깅 정보 ===");
    console.log("dmp_claimFullJoinVo:", dmp_claimFullJoinVo.getJSON());
    console.log("dlt_claimFullJoinList 행 수:", dlt_claimFullJoinList.getRowCount());
    console.log("dlt_claimFullJoinList 데이터:", dlt_claimFullJoinList.getJSON());
};

scwin.checkSearchCondition = function() {
    console.log("=== 현재 검색 조건 ===");
    console.log("input_search 값:", input_search.getValue());
    console.log("claim_no:", dmp_claimFullJoinVo.get("claim_no"));
    
    console.log("\n=== SQL에서 실행될 검색 로직 ===");
    var claimNo = dmp_claimFullJoinVo.get("claim_no");
    if (claimNo && claimNo !== "") {
        console.log("청구번호 검색 모드:");
        console.log("WHERE c.claim_no = '" + claimNo + "'");
    } else {
        console.log("전체 조회 모드");
    }
};]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
    	<xf:group class="sub_contents" id="" meta_snippetCategory="00_화면시작" meta_snippetKeyComponent="true" meta_snippetName="0_01 페이지시작"
    		style="">
    		<xf:group class="pgtbox" id="" meta_snippetCategory="02_타이틀" meta_snippetKeyComponent="true" meta_snippetName="2_01 페이지타이틀"
    			style="">
    			<w2:textbox class="pgt_tit" id="" label="청구번호 조회" style="padding-bottom: 20px;width: 100%;border-bottom: .2px solid #3674B5;padding-bottom: 20px;" tagname="h2"></w2:textbox>
    		</xf:group>

    		<!-- 검색 조건 영역 (수정됨) -->
    		<xf:group id="" style="margin-bottom:15px; padding:10px; background-color:#f5f5f5; border-radius:5px;">
    			<w2:span style="display:inline-block;width:91px;font-weight:bold;" id="" label="청구 번호"></w2:span>
    			<xf:group id="" style="margin-top:10px;">
    				<xf:input id="input_search" style="width:200px; margin-right:10px;" placeholder="청구번호를 입력하세요"
    					ev:onkeyup="scwin.input_search_onkeyup">
    				</xf:input>
    				<xf:trigger class="btn_cm" id="btn_search" style="background-color: #4CAF50; margin-right:5px;" type="button"
    					ev:onclick="scwin.btn_search_onclick">
    					<xf:label><![CDATA[검색]]></xf:label>
    				</xf:trigger>
    				<xf:trigger class="btn_cm" id="btn_reset" style="" type="button"
    					ev:onclick="scwin.btn_reset_onclick">
    					<xf:label><![CDATA[전체조회]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    			<xf:group id="" style="margin-top:8px;">
    				<w2:span style="font-size:12px; color:#666;" id="" label="※ 청구번호를 입력하여 검색하거나, 비워두고 검색하면 전체 목록을 조회합니다."></w2:span>
    			</xf:group>
    		</xf:group>

    		<!-- 조회 결과 표시 영역 -->
    		<xf:group id="" style="margin-bottom:10px;">
    		</xf:group>

    		<!-- 전체 조인 그리드 -->
    		<xf:group adaptiveThreshold="" class="gvwbox" id="" style="">
    			<w2:gridView autoFit="allColumn" checkReadOnlyOnPasteEnable="" class="gvw" dataList="data:dlt_claimFullJoinList"
    				focusMode="row" id="grd_claimEmployee" scrollByColumn="false" scrollByColumnAdaptive="false" style="height: 400px;"
    				ev:ondblclick="scwin.grd_claimEmployee_ondblclick" readOnly="true">
    				<w2:caption id="caption2" style="" value="청구 정보 그리드"></w2:caption>
    				<w2:header id="header2" style="">
    					<w2:row id="row3" style="">
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="column7" value="청구번호" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="120" inputType="text" id="column8" value="청구유형" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="column9" value="고객명" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="column10" value="지급금액" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column width="100" inputType="text" style="" id="column5" value="담당직원" displayMode="label"></w2:column>
    						<w2:column width="80" inputType="text" style="" id="column6" value="상태" displayMode="label"></w2:column>
    					</w2:row>
    				</w2:header>
    				<w2:gBody id="gBody2" style="">
    					<w2:row id="row4" style="">
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="claim_no" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="120" inputType="text" id="claim_type" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="user_name" blockSelect="false"
    							displayMode="label">
    						</w2:column>
    						<w2:column removeBorderStyle="false" width="100" inputType="text" id="amount" blockSelect="false"
    							displayMode="label" displayFormat="#,### 원" defaultValue="0">
    						</w2:column>
    						<w2:column width="100" inputType="text" style="" id="emp_name" value="" displayMode="label"></w2:column>
    						<w2:column width="80" inputType="text" style="" id="status" value="" displayMode="label"></w2:column>
    					</w2:row>
    				</w2:gBody>
    			</w2:gridView>
    		</xf:group>
    	</xf:group>
    </body>
</html>