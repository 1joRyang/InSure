<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
        	<w2:dataCollection baseNode="map">
        		<w2:dataMap baseNode="map" id="dma_additionalReq">
        			<w2:keyInfo>
        				<w2:key dataType="text" name="claim_no" id="claim_no"></w2:key>
        				<w2:key dataType="text" name="additional_memo" id="additional_memo"></w2:key>
        				<w2:key dataType="text" name="request_type" id="request_type"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        	</w2:dataCollection>
        	<w2:workflowCollection />
        	<xf:submission id="sbm_insertAdditionalReq" action="/InsWebApp/ADDITIONALREQInsUp.pwkjson" method="post"
        		mediatype="application/json" ref='data:json,{"id":"dma_additionalReq","key":"additionalReqCusVo"}' target="" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler=""
        		mode="asynchronous" processMsg="처리중입니다..." ev:submit="" ev:submitdone="scwin.sbm_insertAdditionalReq_submitdone" ev:submiterror="scwin.sbm_insertAdditionalReq_submiterror" abortTrigger="">
        	</xf:submission>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function() {
    scwin.claim = JSON.parse(localStorage.getItem("claim"));

    txt_req_supple.setValue(scwin.claim.claimNo);
    dma_additionalReq.set("claim_no", scwin.claim.claimNo);
};

// 보완요청 등록 및 상태 업데이트
scwin.btn_submit_onclick = function (e) {
    // textarea 값 검증
    var additionalMemo = txa_supplement_memo.getValue();
    if (!additionalMemo || additionalMemo.trim() === "") {
       
        txa_supplement_memo.focus();
        return false;
    }

    // dataMap에 값 설정
    dma_additionalReq.set("additional_memo", additionalMemo.trim());
    dma_additionalReq.set("request_type", "SUPPLEMENT"); // 보완요청 타입 설정


    // 서버로 데이터 전송
    $p.executeSubmission("sbm_insertAdditionalReq");
};

// 보완요청 등록 성공 처리
scwin.sbm_insertAdditionalReq_submitdone = function (e) {
    console.log("보완요청 처리 성공:", e);
    $p.closePopup();
    alert("보완 요청 완료");
    location.href = "/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/webWrapper.xml"
    return true;
};

// 보완요청 등록 실패 처리
scwin.sbm_insertAdditionalReq_submiterror = function (e) {
    console.log("보완요청 처리 실패:", e);
    
    var errorMsg = "보완요청 전송 중 오류가 발생했습니다.";
    if (e.responseJSON && e.responseJSON.elHeader && e.responseJSON.elHeader.resMsg) {
        errorMsg = e.responseJSON.elHeader.resMsg;
    }
    console.log(errorMsg);
};

scwin.btn_close_onclick = function(e) {
    $p.closePopup();
    return true;
};
]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
        <xf:group class="sub_contents" id="" meta_snippetCategory="00_화면시작" meta_snippetKeyComponent="true" meta_snippetName="0_01 페이지시작"
            style="">
            <xf:group id="">
                <w2:span id="" label="청구 번호 : " meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
                    meta_snippetName="10_16 출력텍스트" style="">
                </w2:span>
                <w2:span meta_snippetCategory="10_입력폼" meta_snippetName="10_16 출력텍스트" meta_snippetKeyComponent="true" style=""
                    id="txt_req_supple" label="출력텍스트입니다. ">
                </w2:span>
            </xf:group>
            <xf:textarea class="" id="txa_supplement_memo" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
                meta_snippetName="10_09 Textarea_100per" placeholder="보완 요청을 작성 해주세요" style="width:100%;height: 82px;">
            </xf:textarea>
            <xf:group class="btnbox" id="" meta_snippetCategory="08_버튼" meta_snippetKeyComponent="true" meta_snippetName="8_05 팝업전체제어버튼"
                style="">
                <xf:group class="rt" id="" style="">
                    <xf:trigger class="btn_cm " id="btn_close" ev:onclick="scwin.btn_close_onclick" style="" type="button">
                        <xf:label><![CDATA[닫기]]></xf:label>
                    </xf:trigger>
                    <xf:trigger class="btn_cm pt" id="btn_submit" ev:onclick="scwin.btn_submit_onclick" style="" type="button">
                        <xf:label><![CDATA[확인]]></xf:label>
                    </xf:trigger>
                </xf:group>
            </xf:group>
        </xf:group>
    </body>
</html>