<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
        	<w2:dataCollection baseNode="map">
        		<w2:dataMap baseNode="map" id="dma_approvalReq">
        			<w2:keyInfo>
        				<w2:key dataType="text" name="claim_no" id="claim_no"></w2:key>
        				<w2:key dataType="text" name="approval_memo" id="approval_memo"></w2:key>
        				<w2:key dataType="text" name="request_type" id="request_type"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        	</w2:dataCollection>
        	<w2:workflowCollection />
        	<xf:submission id="sbm_rejectApprovalReq" action="/InsWebApp/APPROVALREQReject.pwkjson" method="post"
        		mediatype="application/json" ref='data:json,{"id":"dma_approvalReq","key":"approvalReqVo"}' target="" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler=""
        		mode="asynchronous" processMsg="처리중입니다..." ev:submit="" ev:submitdone="scwin.sbm_rejectApprovalReq_submitdone" ev:submiterror="scwin.sbm_rejectApprovalReq_submiterror" abortTrigger="">
        	</xf:submission>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[const Toast = Swal.mixin({
	    toast: true,
	    showConfirmButton: false,
	})

scwin.toastAlertMobile = (param) => {
	Toast.fire({
		...param, 
		timer: 2000,
		position: 'center',
		timerProgressBar: false,
	});
}
	
scwin.toastAlert = (param) => {
	Toast.fire({
		...param, 
		timer: 3000,
		position: 'top-end',
		timerProgressBar: true,
		didOpen: (toast) => {
			        toast.addEventListener('mouseenter', Swal.stopTimer)
			        toast.addEventListener('mouseleave', Swal.resumeTimer)
			    }
	});
} 

scwin.noBtnAlert = (param) => {
	Swal.fire({
		...param,
		showConfirmButton: false,
	});
}

scwin.noBtnAlertWithTimer = (param) => {
	Swal.fire({
		...param,
		timer: 2000,
		showConfirmButton: false,
	});
}

/** 부르는 형태 예시
scwin.twoBtnAlert({
     title: "로그아웃 하시겠습니까?",
 }, (result) => {
     if (result.isConfirmed) {
         $c.sbm.execute(sbm_EmployeeLogout);
     }
 });
 */
scwin.twoBtnAlert = (param, func) => {
	Swal.fire({
		...param,
		showCancelButton: true,
		confirmButtonColor: '#4FACFE',
		cancelButtonColor: '#d1d1d1',
		confirmButtonText: '완료',
		cancelButtonText: '취소',
		reverseButtons: true
	}).then(func);
}

scwin.onpageload = function() {
    scwin.claim = JSON.parse(localStorage.getItem("claim"));

    txt_req_supple.setValue(scwin.claim.claimNo);
    window.dma_approvalReq.set("claim_no", scwin.claim.claimNo);
    console.log(dma_approvalReq.get("claim_no"));
};

// 결재반려 처리
scwin.btn_submit_onclick = function (e) {
    // textarea 값 검증
    var approvalMemo = txa_supplement_memo.getValue();
    dma_approvalReq.set("approval_memo", approvalMemo);
    if (!approvalMemo || approvalMemo.trim() === "") {
        txa_supplement_memo.focus();
        return false;
    }
    
    $c.sbm.execute(sbm_rejectApprovalReq); // 변경된 submission 사용
};

// 성공 콜백
scwin.sbm_rejectApprovalReq_submitdone = function(e) {
    
    $p.closePopup();
    scwin.noBtnAlertWithTimer({
        icon: 'success',
        title: '결재반려 처리가 완료되었습니다.'
    });
    setTimeout(function() {
        location.href = "/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/webWrapper.xml";
    }, 2000);
};

// 에러 콜백
scwin.sbm_rejectApprovalReq_submiterror = function(e) {
    $p.closePopup();
    scwin.toastAlert({
        icon: 'error',
        title: '결재반려 처리 중 오류가 발생했습니다.'
    });
    console.log(e);
};


scwin.btn_close_onclick = function(e) {
    $p.closePopup();
    return true;
};
]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
        <xf:group class="sub_contents" id="" meta_snippetCategory="00_화면시작" meta_snippetKeyComponent="true" meta_snippetName="0_01 페이지시작"
            style="">
            <xf:group id="">
                <w2:span id="" label="청구 번호 : " meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
                    meta_snippetName="10_16 출력텍스트" style="">
                </w2:span>
                <w2:span meta_snippetCategory="10_입력폼" meta_snippetName="10_16 출력텍스트" meta_snippetKeyComponent="true" style=""
                    id="txt_req_supple" label="출력텍스트입니다. ">
                </w2:span>
            </xf:group>
            <xf:textarea class="" id="txa_supplement_memo" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
                meta_snippetName="10_09 Textarea_100per" placeholder="결재 반려 사유를 작성 해주세요" style="width:100%;height: 82px;">
            </xf:textarea>
            <xf:group class="btnbox" id="" meta_snippetCategory="08_버튼" meta_snippetKeyComponent="true" meta_snippetName="8_05 팝업전체제어버튼"
                style="">
                <xf:group class="rt" id="" style="">
                    <xf:trigger class="btn_cm " id="btn_close" ev:onclick="scwin.btn_close_onclick" style="" type="button">
                        <xf:label><![CDATA[닫기]]></xf:label>
                    </xf:trigger>
                    <xf:trigger class="btn_cm pt" id="btn_submit" ev:onclick="scwin.btn_submit_onclick" style="" type="button">
                        <xf:label><![CDATA[확인]]></xf:label>
                    </xf:trigger>
                </xf:group>
            </xf:group>
        </xf:group>
    </body>
</html>