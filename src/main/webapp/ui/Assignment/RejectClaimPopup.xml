<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
        	<w2:dataCollection baseNode="map">
        		<w2:dataMap baseNode="map" id="dma_approvalReq">
        			<w2:keyInfo>
        				<w2:key dataType="text" name="claim_no" id="claim_no"></w2:key>
        				<w2:key dataType="text" name="approval_memo" id="approval_memo"></w2:key>
        				<w2:key dataType="text" name="request_type" id="request_type"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        	</w2:dataCollection>
        	<w2:workflowCollection />
        	<xf:submission id="sbm_rejectApprovalReq" action="/InsWebApp/APPROVALREQReject.pwkjson" method="post"
        		mediatype="application/json" ref='data:json,{"id":"dma_approvalReq","key":"approvalReqVo"}' target="" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler=""
        		mode="asynchronous" processMsg="처리중입니다..." ev:submit="" ev:submitdone="scwin.sbm_rejectApprovalReq_submitdone" ev:submiterror="scwin.sbm_rejectApprovalReq_submiterror" abortTrigger="">
        	</xf:submission>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function() {
    scwin.claim = JSON.parse(localStorage.getItem("claim"));

    txt_req_supple.setValue(scwin.claim.claimNo);
    dma_approvalReq.set("claim_no", scwin.claim.claimNo);
};

// 결재반려 처리
scwin.btn_submit_onclick = function (e) {
    // textarea 값 검증
    var approvalMemo = txa_supplement_memo.getValue();
    if (!approvalMemo || approvalMemo.trim() === "") {
        txa_supplement_memo.focus();
        return false;
    }
    
    dma_approvalReq.set("approval_memo", approvalMemo);
    $c.sbm.execute(sbm_rejectApprovalReq); // 변경된 submission 사용
};

// 성공 콜백
scwin.sbm_rejectApprovalReq_submitdone = function(e) {
    alert("결재반려 처리가 완료되었습니다.");
    $p.closePopup();
   location.href = "/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/webWrapper.xml"
};

// 에러 콜백
scwin.sbm_rejectApprovalReq_submiterror = function(e) {
    alert("결재반려 처리 중 오류가 발생했습니다.");
    console.log(e);
};


scwin.btn_close_onclick = function(e) {
    $p.closePopup();
    return true;
};
]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
        <xf:group class="sub_contents" id="" meta_snippetCategory="00_화면시작" meta_snippetKeyComponent="true" meta_snippetName="0_01 페이지시작"
            style="">
            <xf:group id="">
                <w2:span id="" label="청구 번호 : " meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
                    meta_snippetName="10_16 출력텍스트" style="">
                </w2:span>
                <w2:span meta_snippetCategory="10_입력폼" meta_snippetName="10_16 출력텍스트" meta_snippetKeyComponent="true" style=""
                    id="txt_req_supple" label="출력텍스트입니다. ">
                </w2:span>
            </xf:group>
            <xf:textarea class="" id="txa_supplement_memo" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
                meta_snippetName="10_09 Textarea_100per" placeholder="결재 반려 사유를 작성 해주세요" style="width:100%;height: 82px;">
            </xf:textarea>
            <xf:group class="btnbox" id="" meta_snippetCategory="08_버튼" meta_snippetKeyComponent="true" meta_snippetName="8_05 팝업전체제어버튼"
                style="">
                <xf:group class="rt" id="" style="">
                    <xf:trigger class="btn_cm " id="btn_close" ev:onclick="scwin.btn_close_onclick" style="" type="button">
                        <xf:label><![CDATA[닫기]]></xf:label>
                    </xf:trigger>
                    <xf:trigger class="btn_cm pt" id="btn_submit" ev:onclick="scwin.btn_submit_onclick" style="" type="button">
                        <xf:label><![CDATA[확인]]></xf:label>
                    </xf:trigger>
                </xf:group>
            </xf:group>
        </xf:group>
    </body>
</html>