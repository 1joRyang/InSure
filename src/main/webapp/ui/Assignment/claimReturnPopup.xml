<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
        	<w2:dataCollection baseNode="map">
        		<w2:dataMap baseNode="map" id="dma_claimNo">
        			<w2:keyInfo>
        				<w2:key dataType="text" name="claim_no" id="claim_no"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        		<w2:dataMap baseNode="map" id="dma_returnReq">
        			<w2:keyInfo>
        				<w2:key dataType="text" name="claim_no" id="claim_no"></w2:key>
        				<w2:key dataType="text" name="return_memo" id="return_memo"></w2:key>
        				<w2:key dataType="text" name="request_date" id="request_date"></w2:key>
        				<w2:key dataType="text" name="completed_date" id="completed_date"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        	</w2:dataCollection>
        	<w2:workflowCollection />
        	<xf:submission id="sbm_insertReturnReq" action="/InsWebApp/RETURNREQInsUp.pwkjson" method="post"
        		mediatype="application/json" ref='data:json,{"id":"dma_returnReq","key":"returnReqVo"}' target="" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler=""
        		mode="asynchronous" processMsg="처리중입니다..." ev:submit="" ev:submitdone="scwin.sbm_insertReturnReq_submitdone" ev:submiterror="scwin.sbm_insertReturnReq_submiterror" abortTrigger="">
        	</xf:submission>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function () {

    scwin.claim = JSON.parse(localStorage.getItem("claim"));

    txt_claim_no.setValue(scwin.claim.claimNo);
    dma_returnReq.set("claim_no", scwin.claim.claimNo);
};

// 추가요청 등록 및 상태 업데이트
scwin.btn_submit_onclick = function (e) {
    // textarea 값 검증
    var returnMemo = txa_additional_memo.getValue();
    if (!returnMemo || returnMemo.trim() === "") {
        console.log("반송 사유를 입력해주세요.");
        txa_additional_memo.focus();
        return false;
    }

    // dataMap에 값 설정
    dma_returnReq.set("return_memo", returnMemo.trim());
    console.log(dma_returnReq.get("return_memo"));
    console.log(dma_returnReq.get("claim_no"));


    // 서버로 데이터 전송
    $p.executeSubmission("sbm_insertReturnReq");
};


scwin.btn_close_onclick = function (e) {
    $p.closePopup();
    return true;
};


scwin.sbm_insertReturnReq_submitdone = function (e) {
    console.log("반송 요청 등록 완료:", e);
    $p.closePopup();
    return true;
};

scwin.sbm_insertReturnReq_submiterror = function (e) {
    console.log("에러 확인용 : ", e);
    return false;
};
]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
    	<xf:group class="sub_contents" id="" meta_snippetCategory="00_화면시작" meta_snippetKeyComponent="true" meta_snippetName="0_01 페이지시작"
    		style="">
    		<xf:group id="">
    			<w2:span id="" label="청구 번호 : " meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    				meta_snippetName="10_16 출력텍스트" style="">
    			</w2:span>
    			<w2:span meta_snippetCategory="10_입력폼" meta_snippetName="10_16 출력텍스트" meta_snippetKeyComponent="true" style=""
    				id="txt_claim_no" label="출력텍스트입니다. ">
    			</w2:span>
    		</xf:group>
    		<xf:textarea class="" id="txa_additional_memo" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    			meta_snippetName="10_09 Textarea_100per" placeholder="반송 사유를 입력해주세요" style="width:100%;height: 82px;">
    		</xf:textarea>
    		<xf:group class="btnbox" id="" meta_snippetCategory="08_버튼" meta_snippetKeyComponent="true" meta_snippetName="8_05 팝업전체제어버튼"
    			style="">
    			<xf:group class="rt" id="" style="">
    				<xf:trigger class="btn_cm " id="btn_close" style=""   ev:onclick="scwin.btn_close_onclick" type="button">
    					<xf:label><![CDATA[닫기]]></xf:label>
    				</xf:trigger>
    				<xf:trigger class="btn_cm pt" id="btn_submit" style="" type="button" ev:onclick="scwin.btn_submit_onclick">
    					<xf:label><![CDATA[확인]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    		</xf:group>
    	</xf:group>
    </body>
</html>