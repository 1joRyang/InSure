<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/InsWebApp/cm/css/claimPage.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare"
    xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
    	<w2:type>DEFAULT</w2:type>
    	<w2:buildDate />
    	<xf:model>
    		<xf:instance>
    			<data xmlns="" />
    		</xf:instance>
    		<w2:dataCollection baseNode="map">
    			<w2:dataMap baseNode="map" id="dma_step1">
    				<w2:keyInfo>
    					<w2:key dataType="text" name="name1" id="claimType"></w2:key>
    				</w2:keyInfo>
    			</w2:dataMap>
    			<w2:dataMap baseNode="map" id="dma_consent">
    				<w2:keyInfo>
    					<w2:key dataType="text" name="name1" id="agreed"></w2:key>
    				</w2:keyInfo>
    			</w2:dataMap>
    			<w2:dataMap baseNode="map" id="dma_claimData">
    				<w2:keyInfo></w2:keyInfo>
    			</w2:dataMap>
    		</w2:dataCollection>
    		<xf:submission id="sbm_saveStep1" action="/InsWebApp/saveStep1.pwkjson" method="post" mediatype="application/json"
    			ref='data:json,{"id":"dma_step1","key":"elData"}' target="" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler=""
    			mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_saveStep1_submitdone" ev:submiterror="" abortTrigger="">
    		</xf:submission>
    		<xf:submission id="sbm_saveConsent" action="/InsWebApp/saveConsent.pwkjson" method="post" mediatype="application/json"
    			ref='data:json,{"id":"dma_consent","key":"elData"}' target="" encoding="UTF-8" instance="" replace="" errorHandler=""
    			customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_saveConsent_submitdone" ev:submiterror=""
    			abortTrigger="">
    		</xf:submission>
    		<xf:submission id="sbm_getClaimData" action="/InsWebApp/getClaimData.pwkjson" method="post" mediatype="application/json" ref=""
    			target='data:json,{"id":"dma_claimData","key":"elData"}' encoding="UTF-8" instance="" replace="" errorHandler="" customHandler=""
    			mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_getClaimData_submitdone" ev:submiterror="" abortTrigger="">
    		</xf:submission>
    	</xf:model>
    	<w2:leaf>true</w2:leaf>
    	<w2:fileName>final_check.xml</w2:fileName>
    	<w2:css src="/css/custom.css"></w2:css>
    	<w2:js src="/js/final_check.js"></w2:js>
    	<w2:engine-version>5.0.0</w2:engine-version>
        <script lazy="false" type="text/javascript"><![CDATA[scwin.selectedType = "";

scwin.isEditMode = false;

scwin.onpageload = function() {
    var urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('mode') === 'edit') {
        scwin.isEditMode = true;
        //수정 모드일 경우 서버에서 기존 데이터 불러오기
        $p.executeSubmission("sbm_getClaimData");
    }
};

scwin.sbm_getClaimData_submitdone = function (e) {
    var claimData = e.responseJSON.elData;
    if (claimData && claimData.claimType) {
        if(claimData.claimType === "disease") {
            scwin.diseaseSelectionBox_onclick();
        } else if (claimData.claimType === "injury") {
            scwin.injurySelectionBox_onclick();
        }
    }
    // 다음 -> 수정완료로 변경
    btnNext.setLabel("수정");
};



scwin.btnNext_onclick = function (e) {

    var selectedType = scwin.selectedType;

    if(scwin.selectedType === ""){
        alert("청구 유형을 선택해주세요.");
        return;
    }
    
    // 1. DataMap에 선택한 값 넣기
    dma_step1.set("claimType", scwin.selectedType);
    console.log(scwin.selectedType);

    // 2. Submission 실행
    $p.executeSubmission("sbm_saveStep1");
};



scwin.diseaseSelectionBox_onclick = function (e) {
    scwin.selectedType = "disease";
    injurySelectionBox.removeClass("selected");
    diseaseSelectionBox.addClass("selected");
};

scwin.injurySelectionBox_onclick = function (e) {
    scwin.selectedType = "injury";
    diseaseSelectionBox.removeClass("selected");
    injurySelectionBox.addClass("selected");
};

scwin.sbm_saveStep1_submitdone = function (e) {
    if (scwin.isEditMode) {
        location.href = "/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/mobile/claim/sixth2.xml";
    } else {
        console.log("TEST: 서브미션 성공. 팝업 열기 시도...");
        var popupUrl="/InsWebApp/ui/mobile/claim/popupConsent2.xml";

        var popupWidth = 300;
        var popupHeight = 380;

        var windowWidth = window.innerWidth;
        var windowHeight = window.innerHeight;

        var leftPosition = (windowWidth / 2) - (popupWidth / 2);
        var topPosition = (windowHeight / 2) - (popupHeight / 2);
        var options = {
            id: "consentPopup",
            type:"iframePopup",
            //width: "300px",
            width: popupWidth + "px",
            height: popupHeight + "px",
            left : leftPosition + "px",
            top: topPosition + "px",
            //height: "380px",
            popupName: "보험금청구에는 동의가 필요해요!",
            modal: true
            //useFixPosition: true,
            //bottom: "0px"
        };

    $p.openPopup(popupUrl, options);
    }
    
};


scwin.popup_callback = function(data){
    if(data === "agree"){
        dma_consent.set("agreed","Y");
        $p.executeSubmission("sbm_saveConsent");
    }
};

scwin.sbm_saveConsent_submitdone = function (e) {
    location.href = "/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/mobile/claim/second.xml"
};


]]></script>
    	<style type="text/css"><![CDATA[/* custom.css */

/*
  ======================================
  Common Styles
  ======================================
*/
.pageWrapper {
    font-family: 'Malgun Gothic', 'Dotum', sans-serif;
    background-color: #f7f7f7;
}

/* Header and Progress Bar */
.pageWrapper > xf\:group:first-child > xf\:group:first-child {
    background-color: #ffffff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

#progressBar {
    height: 100%;
    background-color: #4FACFE;
    transition: width 0.5s ease-in-out;
}

.stepIndicatorContainer {
    padding-top: 10px;
}

.progressBtn {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    border: 2px solid #ccc;
    background-color: #fff;
    color: #ccc;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.3s ease;
    cursor: default;
}

.progressBtn.completed {
    background-color: #4FACFE;
    border-color: #4FACFE;
    color: #fff;
}

.progressBtn.active {
    background-color: #fff;
    border-color: #4FACFE;
    color: #4FACFE;
}

/* Scrollable Main Content Wrapper */
#mainContentWrapper {
    flex: 1; /* Take up all remaining space */
    overflow-y: auto; /* Enable vertical scrolling */
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}

/* Section titles */
.sectionTitle {
    font-size: 16px;
    font-weight: bold;
    color: #333;
}

/* Info Box */
.infoBox {
    width: 100%;
    padding: 20px;
    background-color: #fff;
    border-radius: 10px;
    border: 1px solid #e0e0e0;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

/* Info Row for key-value pairs */
.infoRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.infoLabel {
    font-weight: bold;
    color: #555;
    flex-shrink: 0;
    margin-right: 15px;
}

.infoValue {
    font-weight: 500;
    color: #222;
    text-align: right;
}

/* Text Button (e.g., '수정') */
.textButton {
    background-color: transparent;
    border: none;
    color: #888;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
}

/* Selection Buttons (e.g., '네/아니오') */
.selectionBtn {
    background-color: #fff;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
    cursor: pointer;
}

.selectionBtn:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
}

.selectionBtn.selected {
    border-color: #4FACFE;
    background-color: #4FACFE;
}

.selectionBtn.half {
    flex: 1;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
}

/* Fixed Bottom Button */
.nextBtn {
    width: 100%;
    height: 65px;
    background-color: #4FACFE;
    border-radius: 35px;
    color: white;
    font-size: 22px;
    font-weight: bold;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transition: background-color 0.2s;
}

.nextBtn:hover {
   background-color: #4FACFE;
}

/* Scroll to Top button */
#scrollTopBtn {
    z-index: 100; /* Ensure it's on top */
    cursor: pointer;
}

/* Icon Styles (You must provide the actual image paths) */
.icon {
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
}
.questionIcon { background-image: url('/images/question_icon.png'); width: 16px; height: 16px; }
.arrowUpIcon { background-image: url('/images/arrow_up_icon.png'); }]]></style>
    </head>
    <body ev:onpageload="scwin.onpageload">
        <w2:wframe src="/InsWebApp/ui/mobile/cmmn/m_header_claim.xml" style="" id="" class="wfm_m_header"></w2:wframe>
        <xf:group class="sub_contents2" id="wrapper" style="">
            <xf:group class="header-section" id="header" style="">
                <w2:textbox class="step_tit" id="" label="청구유형" style="" tagname=""></w2:textbox>
                <xf:group class="step" id="" style="">
                    <xf:group id="" style="" tagname="ul">
                    	<xf:group class="current" id="" style="" tagname="li">
                    		<w2:span id="" label="1" style=""></w2:span>
                    	</xf:group>

                    	<xf:group class="inactive" id="" style="" tagname="li">
                    		<w2:span id="" label="2" style=""></w2:span>
                    	</xf:group>
                    	<xf:group class="inactive" id="" style="" tagname="li">
                    		<w2:span id="" label="3" style=""></w2:span>
                    	</xf:group>
                    	<xf:group class="inactive" id="" style="" tagname="li">
                    		<w2:span id="" label="4" style=""></w2:span>
                    	</xf:group>
                    	<xf:group class="inactive" id="" style="" tagname="li">
                    		<w2:span id="" label="5" style=""></w2:span>
                    	</xf:group>
                    	<xf:group class="inactive" id="" style="" tagname="li">
                    		<w2:span id="" label="6" style=""></w2:span>
                    	</xf:group>
                    	<xf:group class="inactive" id="" style="" tagname="li">
                    		<w2:span id="" label="7" style=""></w2:span>
                    	</xf:group>
                    </xf:group>
                </xf:group>
            </xf:group>

            <xf:group class="content-section" id="mainContent" style="margin: 0 auto;">
                <w2:textbox class="question-text" id="" label="어떤 진료로 방문하셨나요?" style=""></w2:textbox>

                <xf:group class="selection-box-container" id="diseaseSelectionBox" ev:onclick="scwin.diseaseSelectionBox_onclick">
                    <xf:image src="../../../images/insure/injecting.png" class="selection-box-icon" id="imgDiseaseIcon"></xf:image>
                    <w2:textbox id="" label="아팠어요(질병)" class="selection-box-text"></w2:textbox>
                </xf:group>

                <xf:group class="selection-box-container" id="injurySelectionBox" ev:onclick="scwin.injurySelectionBox_onclick">
                    <xf:image src="../../../images/insure/bandage.png" class="selection-box-icon" id="imgInjuryIcon"></xf:image>
                    <w2:textbox id="" label="다쳤어요(상해)" class="selection-box-text"></w2:textbox>
                </xf:group>

                <xf:group style="flex: 1;" id=""></xf:group>
            </xf:group>

            <xf:group class="footer-section" id="footer" style="">
                <w2:button class="next-button" id="btnNext" label="다음" ev:onclick="scwin.btnNext_onclick"></w2:button>
            </xf:group>
        </xf:group>
    </body>
</html>